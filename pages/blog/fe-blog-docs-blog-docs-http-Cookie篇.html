<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTTP Cookie篇 - FrontendHub</title>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/content.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="content-page">
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="../../index.html" style="color: inherit; text-decoration: none; display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-code"></i>
                    <span>FrontendHub</span>
                </a>
            </div>
            <button class="nav-toggle" id="navToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-menu" id="navMenu">
                <li><a href="../../index.html">首页</a></li>
                <li><a href="../index.html#features">特色</a></li>
                <li><a href="../index.html#courses">课程</a></li>
                <li><a href="../index.html#resources">资源</a></li>
            </ul>
        </div>
    </nav>

    <!-- 面包屑导航 -->
    <div class="breadcrumb">
        <div class="container">
            <a href="../../index.html"><i class="fas fa-home"></i> 首页</a>
            <i class="fas fa-chevron-right"></i>
            <span>HTTP Cookie篇</span>
        </div>
    </div>

    <!-- 主要内容区 -->
    <main class="content-main">
        <div class="container">
            <div class="content-layout">
                <!-- 侧边栏目录 -->
                <aside class="sidebar">
                    <div class="sidebar-sticky">
                        <h3><i class="fas fa-list"></i> 目录</h3>
                        <nav class="toc" id="toc">
                            <!-- 目录将通过JavaScript自动生成 -->
                        </nav>
                    </div>
                </aside>

                <!-- 文章内容 -->
                <article class="article">
                    <header class="article-header">
                        <h1>HTTP Cookie篇</h1>
                        <div class="article-meta">
                            <span><i class="far fa-calendar"></i> 更新时间：2025-12-23</span>
                            <span><i class="far fa-clock"></i> 阅读时长：约 15 分钟</span>
                        </div>
                    </header>

                    <div class="article-content">
<div class="content__default"><h2 id="本篇目录"><a href="#本篇目录" class="header-anchor">#</a> 本篇目录</h2> <p>通过阅读本篇文章你可以学习到：</p> <ul><li>Cookie概念</li> <li>产生原因</li> <li>关于Cookie的首部字段</li> <li>交互流程</li> <li>生命周期</li> <li>作用域</li> <li>安全性</li> <li>实际的用处</li> <li>缺点</li></ul> <h2 id="_1-cookie概念"><a href="#_1-cookie概念" class="header-anchor">#</a> 1. Cookie概念</h2> <p>概念：通过在请求和响应报文中写入Cookie信息来控制客户端的状态，解决HTTP无状态的问题，本质就是存储在浏览器上一个很小的文本文件(也可能存在本地文件里)</p> <h2 id="_2-产生原因"><a href="#_2-产生原因" class="header-anchor">#</a> 2. 产生原因</h2> <p>HTTP是一种无状态协议，没法保存之前请求响应的上下文信息，但是对于一些场景来说需要用到之前的状态，所以为了解决这个问题产生了Cookie。但是它并不是为了解决通讯协议无状态的问题，而是为了解决客户端与服务端会话状态的问题，这个状态是指后段服务的状态而不是通讯协议的状态。</p> <h2 id="_3-关于cookie的首部字段"><a href="#_3-关于cookie的首部字段" class="header-anchor">#</a> 3. 关于Cookie的首部字段</h2> <p>关于Cookie的首部字段其实不太多，主要为：</p> <ul><li><code>Set-Cookie</code></li> <li><code>Cookie</code></li></ul> <h3 id="_3-1-set-cookie"><a href="#_3-1-set-cookie" class="header-anchor">#</a> 3.1 Set-Cookie</h3> <p>作用：在响应报文首部设置要传递给客户端的Cookie信息</p> <p>例如：</p> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: name=xxx; HttpOnly
</code></pre></div><h3 id="_3-2-cookie"><a href="#_3-2-cookie" class="header-anchor">#</a> 3.2 Cookie</h3> <p>作用：客户端传递给服务端的Cookie信息</p> <p>例如：</p> <div class="language- extra-class"><pre class="language-text"><code>Cookie: name=xxx
</code></pre></div><h2 id="_4-交互流程"><a href="#_4-交互流程" class="header-anchor">#</a> 4. 交互流程</h2> <h3 id="_4-1-主要流程"><a href="#_4-1-主要流程" class="header-anchor">#</a> 4.1 主要流程</h3> <p>客户端和服务器关于<code>Cookie</code>的交互流程如下：</p> <ol><li>客户端请求服务端</li> <li>服务端生成Cookie信息使用 Set-Cookie 添加到响应报文头部上</li> <li>客户端在拿到之后保存Cookie</li> <li>在下次请求的时候通过把信息写入请求报文头部Cookie字段中传给服务端</li></ol> <h3 id="_4-2-设置cookie的实际案例"><a href="#_4-2-设置cookie的实际案例" class="header-anchor">#</a> 4.2  设置Cookie的实际案例</h3> <p>光看上面👆说的可能有点迷糊，让我们结合一个实际的案例看看。</p> <p>这里就以<code>koa</code>来模拟一个后台的登录接口，下面的代码主要做了四件事：</p> <ul><li>设置响应的一些公共首部字段</li> <li>对每个请求做一些处理，例如登录接口则不验证token</li> <li>定义了一个名为<code>/api/corsname</code>的接口，用来获取名字</li> <li>定义了一个名为<code>/api/login</code>的接口，用来用户登录，并设置<code>Cookie</code></li></ul> <p><em>./server.js</em>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"koa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"koa-router"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> koaBody <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"koa-body"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">TOKEN</span> <span class="token operator">=</span> <span class="token string">"112233"</span><span class="token punctuation">;</span> <span class="token comment">// 模拟写死一个token</span>

<span class="token comment">// 这里设置一些公共的首部字段</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin"</span><span class="token punctuation">,</span> ctx<span class="token punctuation">.</span>header<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Request-Method"</span><span class="token punctuation">,</span> <span class="token string">"PUT,POST,GET,DELETE,OPTIONS"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>
    <span class="token string">"Access-Control-Allow-Headers"</span><span class="token punctuation">,</span>
    <span class="token string">"Origin, X-Requested-With, Content-Type, Access"</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 若是登录接口则跳过后面的token验证</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">"/api/login"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 对所有非登录的请求验证token</span>
  <span class="token keyword">const</span> cookies <span class="token operator">=</span> ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>cookies<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>cookies <span class="token operator">&amp;&amp;</span> cookies <span class="token operator">===</span> <span class="token constant">TOKEN</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">401</span><span class="token punctuation">,</span>
    <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">"权限错误"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 如果不加multipart：true ctx.request.body会获取不到值</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">koaBody</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">multipart</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/api/corsname"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token string">"LinDaiDai"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/api/login"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span> <span class="token constant">TOKEN</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token comment">// 在此处设置 token</span>
    <span class="token literal-property property">expires</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">"成功"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"server 8080..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>OK👌，来看看客户端(浏览器端)调用这两个接口的代码：</p> <p><em>./index.html</em>:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>CORS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getName<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>获取name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>login<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.bootcss.com/axios/0.19.2/axios.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    axios<span class="token punctuation">.</span>defaults<span class="token punctuation">.</span>baseURL <span class="token operator">=</span> <span class="token string">'http://xxx.com'</span>
    login<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/login'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    getName<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api/corsname'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>此时，点击「登录」按钮，可以在<code>/login</code>这个接口的响应体中看到<code>Set-Cookie</code>这个首部字段：</p> <p><img src="https://s.poetries.top/images/202203211341481.png" alt=""></p> <p>(图里红色圈中的<code>Access-Control-Allow-Credentials: true</code>请忽略它，因为这张图是另一篇文章中拿来的，所以重点是<code>Set-Cookie</code>)</p> <p>登录成功之后，点击「获取name」按钮，可以在<code>/corsname</code>这个接口的请求体中看到<code>Cookie</code>这个首部字段：</p> <p><img src="https://s.poetries.top/images/202203211341133.png" alt=""></p> <p>再来看看在浏览器中，我们可以如何查看<code>Cookie</code>：</p> <p><img src="https://s.poetries.top/images/202203211341703.png" alt=""></p> <h2 id="_5-生命周期"><a href="#_5-生命周期" class="header-anchor">#</a> 5. 生命周期</h2> <p>在上面有介绍到关于<code>Cookie</code>的首部字段主要是<code>Set-Cookie</code>和<code>Cookie</code>，那有关于<code>Cookie</code>生命周期的首部字段的属性有哪些呢？也就是可以用什么来控制<code>Cookie</code>的生命周期。</p> <ul><li>默认情况下<code>Cookie</code>是暂时存在的，也就是它们的存储只在浏览器会话期间存在，当用户在关闭浏览器时失效</li> <li>可以使用<code>expires</code>和<code>max-age</code>来设置<code>Cookie</code>的过期时间</li></ul> <h3 id="_5-1-expires-date"><a href="#_5-1-expires-date" class="header-anchor">#</a> 5.1 expires=DATE</h3> <p>作用：给<code>Cookie</code> 设置过期时间，一个具体的时间。</p> <p>默认值：默认为设置的<code>expires</code>的当前时间。</p> <p>案例：</p> <p>例如后端代码中：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span> <span class="token string">'112233'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	<span class="token literal-property property">expires</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span> <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>此时接口请求的响应体的首部字段带有：</p> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: token=112233; expires=Wed Aug 12 2020 21:55:03 GMT
</code></pre></div><h3 id="_5-2-max-age-time"><a href="#_5-2-max-age-time" class="header-anchor">#</a> 5.2 max-age=TIME</h3> <p>作用：给<code>Cookie</code>设置过期时间，一段时间，单位是秒，从客户端收到报文开始计算。</p> <p>默认值：<code>-1</code>。</p> <p>使用方式与<code>expires</code>一样：</p> <p>例如后端代码中：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span> <span class="token string">'112233'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
	max<span class="token operator">-</span>age<span class="token operator">:</span> <span class="token number">36000</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>此时接口请求的响应体的首部字段带有：</p> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: token=112233; max-age=36000	
</code></pre></div><p>另外，属性值分为以下三种，方便记忆：</p> <ul><li>0：立即删除这个<code>Cookie</code></li> <li>正数：浏览器将其持久化写入<code>Cookie</code>中</li> <li>负数：会话性<code>Cookie</code></li></ul> <p>针对于上面👆的三种情况，面试时可能会碰到的问题：</p> <h4 id="q1-cookie的max-age属性设置为0会怎样"><a href="#q1-cookie的max-age属性设置为0会怎样" class="header-anchor">#</a> Q1: cookie的max-age属性设置为0会怎样？</h4> <p>A：如果<code>max-age</code>为0，则表示删除该<code>cookie</code>。<code>cookie</code>机制没有提供删除<code>cookie</code>的方法，因此通过设置该<code>cookie</code>即时失效实现删除<code>cookie</code>的效果。失效的<code>Cookie</code>会被浏览器从<code>cookie</code>文件或者内存中删除。</p> <h4 id="q2-设置了cookie的max-age属性为正数-关闭浏览器会怎样"><a href="#q2-设置了cookie的max-age属性为正数-关闭浏览器会怎样" class="header-anchor">#</a> Q2：设置了cookie的max-age属性为正数，关闭浏览器会怎样？</h4> <p>A：如果<code>max-age</code>属性为正数，则表示该<code>cookie</code>会在<code>max-age</code>秒之后自动失效。浏览器会将<code>max-age</code>为正数的<code>cookie</code>持久化，即写到对应的<code>cookie</code>文件中。无论客户关闭了浏览器还是电脑，只要还在<code>max-age</code>秒之前，登录网站时该<code>cookie</code>仍然有效。</p> <h4 id="q3-设置了cookie的max-age属性为负数-会怎样"><a href="#q3-设置了cookie的max-age属性为负数-会怎样" class="header-anchor">#</a> Q3：设置了cookie的max-age属性为负数，会怎样？</h4> <p>A：如果<code>max-age</code>为负数，则表示该<code>cookie</code>仅在本浏览器窗口以及本窗口打开的子窗口内有效，关闭窗口后该<code>cookie</code>即失效。<code>max-age</code>为负数的<code>Cookie</code>，为临时性<code>cookie</code>，不会被持久化，不会被写到<code>cookie</code>文件中。<code>cookie</code>信息保存在浏览器内存中，因此关闭浏览器该<code>cookie</code>就消失了。<code>cookie</code>默认的<code>max-age</code>值为<code>-1</code>。</p> <h2 id="_6-作用域"><a href="#_6-作用域" class="header-anchor">#</a> 6. 作用域</h2> <p>作用域概念：对于<code>Cookie</code>的作用域，表示的是给<code>Cookie</code>绑定域名和路径，在发送请求之前若是发现域名或者路径这两个属性不匹配则不会携带<code>Cookie</code>，通俗来说就是在哪些情况下携带<code>Cookie</code>。</p> <p>有关于<code>Cookie</code>作用域的首部字段有哪些呢？</p> <ul><li><code>domain=域名</code></li> <li><code>path=PATH</code></li></ul> <h3 id="_6-1-domain-域名"><a href="#_6-1-domain-域名" class="header-anchor">#</a> 6.1 domain=域名</h3> <p>作用：指定<code>Cookie</code>可以送达的主机名。</p> <p>例如：</p> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: domain=.example.com
</code></pre></div><h3 id="_6-2-path-path"><a href="#_6-2-path-path" class="header-anchor">#</a> 6.2 path=PATH</h3> <p>作用：指定一个<code>URL</code>路径，<code>Cookie</code>首部只会被添加到这个指定<code>URL</code>路径的请求报文首部上。</p> <p>默认值为：<code>/</code>，也就是所有<code>URL</code>路径都会携带<code>Cookie</code>。</p> <p>例如设置了：</p> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: name=xxx; path=/docs
</code></pre></div><p>那么只有<code>/docs</code> 下的资源才会带有<code>Cookie</code>，而另一个名为<code>/test</code> 的目录下就没有。</p> <h2 id="_7-安全性"><a href="#_7-安全性" class="header-anchor">#</a> 7. 安全性</h2> <p><code>Cookie</code>的安全性也是一个常问的点，这方面涉及到的首部字段的属性主要有：</p> <ul><li><code>Secure</code></li> <li><code>HttpOnly</code></li> <li><code>SameSite</code></li></ul> <h3 id="_7-1-secure"><a href="#_7-1-secure" class="header-anchor">#</a> 7.1 Secure</h3> <p>作用：设置了<code>secure</code>属性，表示<code>Cookie</code>只在<code>HTTPS</code>下传输。</p> <p>例如：</p> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: name=xxx; secure
</code></pre></div><p>让我们来看一个实际的运用场景。</p> <p>前提条件：https://lindaidai.com 对<code>cookie</code>设置了<code>secure=true</code>属性。</p> <ol><li><p>访问 https://lindaidai.com</p></li> <li><p>输入用户名、密码，用<code>Chrome</code>的<code>developer tool</code>会看到<code>response</code>的<code>header</code>里，<code>set-cookie</code>的值里有<code>secure</code>属性</p></li> <li><p>登录后，继续访问https://lindaidai.com/#user ，可以正常看到内容</p></li> <li><p>修改url，访问http://lindaidai.com/#domain ，会跳转到登录页面，因为<code>cookie</code>在<code>http</code>协议下不发送给服务器，服务器要求用户重新登录</p></li></ol> <h3 id="_7-2-httponly"><a href="#_7-2-httponly" class="header-anchor">#</a> 7.2 HttpOnly</h3> <p>作用：带上<code>HttpOnly</code>的<code>Cookie</code>只能通过HTTP协议传输，不能通过<code>JS</code>脚本文件访问(<code>document.cookie</code>)。</p> <p>例如：</p> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: name=xxx; HttpOnly
</code></pre></div><p>由于设置了<code>HttpOnly</code>标志的<code>Cookie</code>只能使用在<code>HTTP</code>请求过程中，而无法用<code>JS</code>脚本来读取；又因为很多的<code>XSS</code>攻击都是通过盗用<code>Cookie</code>的，所以设置<code>HttpOnly</code>属性也能保护我们<code>Cookie</code>的安全，是一种预防<code>XSS</code>攻击的重要手段吧。</p> <h3 id="_7-3-samesite"><a href="#_7-3-samesite" class="header-anchor">#</a> 7.3 SameSite</h3> <p>作用：用来限制第三方<code>Cookie</code>，一般用来防止<code>CSRF</code>攻击。</p> <p>默认值：<code>Chrome80</code>之前一直是<code>None</code>，在<code>Chrome80</code>之后为<code>Lax</code>。</p> <p>例如：</p> <div class="language- extra-class"><pre class="language-text"><code>Set-Cookie: name=xxx; SameSite=Lax
</code></pre></div><p>对于第一方<code>Cookie</code>和第三方<code>Cookie</code>我在这里推荐一篇比较好的文章，值得静下心来好好看：</p> <p><a href="https://www.jianshu.com/p/7e7d41cd2bac" target="_blank" rel="noopener noreferrer">《关于第一方Cookie和第三方Cookie你需要知道的》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h4 id="q1-什么是第一方cookie和第三方cookie"><a href="#q1-什么是第一方cookie和第三方cookie" class="header-anchor">#</a> Q1：什么是第一方Cookie和第三方Cookie</h4> <p>两种类型的<code>Cookie</code>：</p> <ul><li>第一方<code>Cookie</code>：由主机域(用户正在访问的域)，这些类型的Cookie通常被认为是不错的。它们有助于提供更好的用户体验，并使会话保持打开状态。基本上，这意味着浏览器能够记住关键信息，例如您添加到购物车中的项目，用户名和密码以及语言首选项。</li> <li>第三方<code>Cookie</code>：由用户当时所访问的域以外的域创建的Cookie，主要用于跟踪和在线广告目的。它们还允许网站所有者提供某些服务，例如实时聊天。</li></ul> <h4 id="q2-两者有何不同"><a href="#q2-两者有何不同" class="header-anchor">#</a> Q2：两者有何不同？</h4> <p>第一方<code>Cookie</code>和第三方<code>Cookie</code>，都是网站在客户端上存放的一小块数据。他们都由某个域存放，只能被这个域访问。他们的区别其实并不是技术上的区别，而是使用方式上的区别。</p> <p>一个例子：</p> <blockquote><p>比如，访问A这个网站，这个网站设置了一个Cookie，这个Cookie也只能被A这个域下的网页读取，这就是第一方Cookie。如果还是访问A这个网站，网页里有用到B网站（和A网站的域名是不同的）的一张图片，浏览器在B请求图片的时候，B设置了一个Cookie，那这个Cookie只能被B这个域访问，反而不能被A这个域访问，因为对我们来说，我们实际是在访问A网站时，被设置了一个B这个域下的Cookie，所以叫第三方Cookie。</p> <p>（你我他；你：A网站，我：浏览器，他：B网站；‘他’ 就是第三方，所以B网站下的cookie是第三方cookie。）</p></blockquote> <p>像上面的这个案例，在A网站中用到B网站的<code>Cookie</code>，如果这两个网站不同站的话，就属于<code>第三方Cookie跨站点使用</code>。</p> <h4 id="q3-对同站和跨站的理解"><a href="#q3-对同站和跨站的理解" class="header-anchor">#</a> Q3：对同站和跨站的理解</h4> <p>同站：只要两个URL的<code>eTLD+1</code>相同即为同站</p> <div class="language- extra-class"><pre class="language-text"><code>eTLD + 1 = 顶级域名 + 二级域名
类似于 example.com
</code></pre></div><p>其它例子：</p> <ul><li><p>同站：</p> <div class="language- extra-class"><pre class="language-text"><code>www.a.example.com
www.b.example.com
</code></pre></div></li> <li><p>跨站：</p> <div class="language- extra-class"><pre class="language-text"><code>www.a.example.com
www.a.example2.com
</code></pre></div></li> <li><p>特殊的(下面这种情况是跨站)：</p> <div class="language- extra-class"><pre class="language-text"><code>a.github.com
b.github.com
</code></pre></div></li></ul> <h4 id="q4-samesite有哪些属性值"><a href="#q4-samesite有哪些属性值" class="header-anchor">#</a> Q4：SameSite有哪些属性值？</h4> <p>在上面👆已经介绍了有关于<code>SameSite</code>的作用，那么具体是如何来控制第三方<code>Cookie</code>的呢？</p> <p>实际上就是通过给<code>SameSite</code>设置不同的属性值来控制的。</p> <p>主要分为三种：</p> <ul><li><code>Strict</code></li> <li><code>Lax</code></li> <li><code>None</code></li></ul> <p>来看看具体的作用：</p> <p><em>Strict</em>：</p> <p>最为严格，完全禁止第三方Cookie跨站点使用
也就是只有网页的URL和请求目标的URL一致才会携带Cookie</p> <p><em>Lax</em>：</p> <p>允许部分第三方请求携带<code>Cookie</code>。</p> <p>也就是只能允许 链接、预加载、GET表单 发送<code>Cookie</code>。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prerender<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span>
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>GET<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>...<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><em>None</em>：</p> <p>无论是否跨站都会发送<code>Cookie</code>。</p> <h4 id="q5-samesite在使用时需要注意什么"><a href="#q5-samesite在使用时需要注意什么" class="header-anchor">#</a> Q5：SameSite在使用时需要注意什么？</h4> <ul><li>对于默认值，<code>Chrome80</code>之前一直是<code>None</code>，在<code>Chrome80</code>之后为<code>Lax</code>。</li> <li><code>HTTP</code>接口不支持<code>SameSite=None</code>，必须配合<code>Secure</code>属性，表示只有在<code>HTTPS</code>协议下才发送<code>Cookie</code>；</li> <li>需要进行<code>UA</code>检测，部分浏览器不能加<code>SameSite=None</code>，<code>IOS12</code>的<code>Safari</code>以及老的<code>Chrome</code>浏览器会把<code>SameSite=None</code>当成<code>Same=Strict</code>，所以需要用<code>User-Agent</code>获取浏览器信息对一些浏览器不下发<code>Cookie</code></li></ul> <h2 id="_8-实际的用处"><a href="#_8-实际的用处" class="header-anchor">#</a> 8. 实际的用处</h2> <p><code>Cookie</code>实际的用处其实非常多，主要有：</p> <ul><li>会话状态管理（如用户登录状态、购物车、游戏分数或其它需要记录的信息）</li> <li>个性化设置（如用户自定义设置、主题等）</li> <li>浏览器行为跟踪（如跟踪分析用户行为等）</li></ul> <h2 id="_9-缺点"><a href="#_9-缺点" class="header-anchor">#</a> 9. 缺点</h2> <ul><li>容量缺陷。Cookie 的体积上限只有4KB，只能用来存储少量的信息。</li> <li>性能缺陷。Cookie 紧跟域名，不管域名下面的某一个地址需不需要这个 Cookie ，请求都会携带上完整的 Cookie，使得请求会携带不必要的参数。但是可以通过Domain和Path指定作用域来解决</li> <li>安全缺陷。由于 Cookie 以纯文本的形式在浏览器和服务器中传递，很容易被非法用户截获。在HttpOnly为false的情况下可以通过JS脚本获取到。</li> <li></li></ul> <h2 id="直接拿吧"><a href="#直接拿吧" class="header-anchor">#</a> 直接拿吧</h2> <p>最后，千言万语汇成一张图...</p> <p><img src="https://s.poetries.top/images/202203211343258.png" alt=""></p></div> <!----> <div class="readMore-wrapper"><span class="readMore">阅读全文</span></div>
                    </div>
                            <p>这是一个信息提示框。</p>
                        </div>

                        <div class="note warning">
                            <div class="note-title"><i class="fas fa-exclamation-triangle"></i> 注意</div>
                            <p>这是一个警告提示框。</p>
                        </div>

                        <div class="note success">
                            <div class="note-title"><i class="fas fa-check-circle"></i> 成功</div>
                            <p>这是一个成功提示框。</p>
                        </div>

                        <h2>代码示例</h2>
                        <pre><code class="language-javascript">// 示例代码
function example() {
    console.log('Hello, FrontendHub!');
}
</code></pre>
                    </div>

                    <!-- 文章底部导航 -->
                    <nav class="article-nav">
                        <a href="#" class="prev-article">
                            <i class="fas fa-chevron-left"></i>
                            <span>上一篇</span>
                        </a>
                        <a href="#" class="next-article">
                            <span>下一篇</span>
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </nav>
                </article>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4><i class="fas fa-code"></i> FrontendHub</h4>
                    <p>专注于前端技术学习与面试准备</p>
                </div>
                <div class="footer-section">
                    <h4>快速链接</h4>
                    <ul>
                        <li><a href="../../index.html">首页</a></li>
                        <li><a href="../index.html#courses">课程体系</a></li>
                        <li><a href="../index.html#resources">学习资源</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 FrontendHub. 用于个人学习使用.</p>
            </div>
        </div>
    </footer>

    <!-- 返回顶部按钮 -->
    <button class="back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script src="../../js/main.js"></script>
    <script src="../../js/content.js"></script>
</body>
</html>

