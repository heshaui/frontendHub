<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="no-referrer">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript进阶_执行上下文 - FrontendHub</title>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/content.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="content-page">
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="../../index.html" style="color: inherit; text-decoration: none; display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-code"></i>
                    <span>FrontendHub</span>
                </a>
            </div>
            <button class="nav-toggle" id="navToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-menu" id="navMenu">
                <li><a href="../../index.html">首页</a></li>
                <li><a href="../index.html#features">特色</a></li>
                <li><a href="../index.html#courses">课程</a></li>
                <li><a href="../index.html#resources">资源</a></li>
            </ul>
        </div>
    </nav>

    <!-- 面包屑导航 -->
    <div class="breadcrumb">
        <div class="container">
            <a href="../../index.html"><i class="fas fa-home"></i> 首页</a>
            <i class="fas fa-chevron-right"></i>
            <span>JavaScript进阶_执行上下文</span>
        </div>
    </div>

    <!-- 主要内容区 -->
    <main class="content-main">
        <div class="container">
            <div class="content-layout">
                <!-- 侧边栏目录 -->
                <aside class="sidebar">
                    <div class="sidebar-sticky">
                        <h3><i class="fas fa-list"></i> 目录</h3>
                        <nav class="toc" id="toc">
                            <!-- 目录将通过JavaScript自动生成 -->
                        </nav>
                    </div>
                </aside>

                <!-- 文章内容 -->
                <article class="article">
                    <header class="article-header">
                        <h1>JavaScript进阶_执行上下文</h1>
                        <div class="article-meta">
                            <span><i class="far fa-calendar"></i> 更新时间：2025-12-23</span>
                            <span><i class="far fa-clock"></i> 阅读时长：约 15 分钟</span>
                        </div>
                    </header>

                    <div class="article-content">
<div class="content__default"><h3 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h3> <p>在编程这个行业中总是能听到这个词“执行上下文”。那么什么叫“执行上下文”呢？</p> <p>本篇文章主要是介绍<code>javascript</code>中的执行上下文, 看完之后你可以了解到:</p> <ul><li>执行上下文的类型</li> <li>执行上下文特点</li> <li>执行栈</li> <li>执行上下文的生命周期</li></ul> <h3 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h3> <p>首先我们来介绍什么是“执行上下文”.</p> <p>举个例子，生活中，相同的话在不同的场合说可能会有不同的意思，而这个说话的场合就是我们说话的语境。</p> <p>同样对应在编程中， 对程序语言进行“解读”的时候，也必须在特定的语境中，这个语境就是<code>javascript</code>中的执行上下文。</p> <p>一句话概括：</p> <blockquote><p>执行上下文就是<code>javascript</code>代码被解析和执行时所在环境的抽象概念。</p></blockquote> <h3 id="执行上下文的类型"><a href="#执行上下文的类型" class="header-anchor">#</a> 执行上下文的类型</h3> <p>在<code>js</code>中，执行上下文分为以下三种：</p> <ul><li><strong>全局执行上下文</strong>：只有一个，也就是浏览器对象(即<code>window</code>对象)，<code>this</code>指向的就是这个全局对象。</li> <li><strong>函数执行上下文</strong>：有无数个，只有在函数<strong>被调用</strong>时才会被<strong>创建</strong>，每次调用函数都会创建一个新的执行上下文。</li> <li><strong>Eval函数执行上下文</strong>：<code>js</code>的<code>eval</code>函数执行其内部的代码会创建属于自己的执行上下文, 很少用而且不建议使用。</li></ul> <h3 id="执行上下文的特点"><a href="#执行上下文的特点" class="header-anchor">#</a> 执行上下文的特点</h3> <ol><li>单线程，只在主线程上运行；</li> <li>同步执行，从上向下按顺序执行；</li> <li>全局上下文只有一个，也就是<code>window</code>对象；</li> <li>函数执行上下文没有限制；</li> <li>函数每调用一次就会产生一个新的执行上下文环境。</li></ol> <h3 id="js如何管理多个执行上下文"><a href="#js如何管理多个执行上下文" class="header-anchor">#</a> JS如何管理多个执行上下文</h3> <p>通过上面介绍，我们知道了<code>js</code>代码在运行时可能会产生无数个执行上下文，那么它是如何管理这些执行上下文的呢？</p> <p>同时由于<code>js</code>是单线程的，所以不能同时干两件事，必须一个个去执行，那么这么多的执行上下文是按什么顺序执行的呢？</p> <h3 id="执行栈"><a href="#执行栈" class="header-anchor">#</a> 执行栈</h3> <p>接下来就对上面的问题做出解答，管理多个执行上下文靠的就是<strong>执行栈</strong>，也被叫做<strong>调用栈</strong>。</p> <p><strong>特点</strong>：后进先出（LIFO）的结构。</p> <p><strong>作用</strong>：存储在代码执行期间的所有执行上下文。</p> <p>（<code>LIFO</code>: <code>last-in, first-out</code>，类似于向乒乓球桶中放球，最先放入的球最后取出）</p> <p><code>js</code>在首次执行的时候，会创建一个<strong>全局执行上下文</strong>并推入栈中。</p> <p>每当有函数被调用时，引擎都会为该函数创建一个新的<strong>函数执行上下文</strong>然后推入栈中。</p> <p>当栈顶的函数执行完毕之后，该函数对应的<strong>执行上下文</strong>就会从执行栈中<code>pop</code>出，然后上下文控制权移到下一个执行上下文。</p> <p>比如下面的一个例子🌰：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 1. 全局上下文环境</span>
<span class="token keyword">function</span> <span class="token function">bar</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token function">fn</span><span class="token punctuation">(</span>x <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3. fn上下文环境</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">fn</span> <span class="token punctuation">(</span><span class="token parameter">c</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2. bar上下文环境</span>
</code></pre></div><p>如下图：</p> <p><img src="https://hexo-blog-1256114407.cos.ap-shenzhen-fsi.myqcloud.com/context1.png" alt="context1"></p> <h3 id="执行上下文的生命周期"><a href="#执行上下文的生命周期" class="header-anchor">#</a> 执行上下文的生命周期</h3> <p>执行上下文的生命周期也非常容易理解, 分为三个阶段:</p> <ol><li>创建阶段</li> <li>执行阶段</li> <li>销毁阶段</li></ol> <h3 id="创建阶段"><a href="#创建阶段" class="header-anchor">#</a> 创建阶段</h3> <p>在<strong>创建阶段</strong>, 主要有是有这么几件事:</p> <ol><li>确定<strong>this</strong>的值, 也就是<strong>绑定this</strong> (<strong>This Binding</strong>);</li> <li>**词法环境(LexicalEnvironment)**组件被创建;</li> <li>**变量环境(VariableEnvironment)**组件被创建.</li></ol> <p><em>一张图方便你理解</em> 🤔</p> <p><img src="https://hexo-blog-1256114407.cos.ap-shenzhen-fsi.myqcloud.com/executionContext1.jpg" alt="executionContext1"></p> <p>有一些教材中也喜欢用伪代码来实现:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ExecutionContext <span class="token operator">=</span> <span class="token punctuation">{</span>  
  ThisBinding <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token keyword">this</span> value<span class="token operator">&gt;</span><span class="token punctuation">,</span>     <span class="token comment">// 确定this </span>
  LexicalEnvironment <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>   <span class="token comment">// 词法环境</span>
  VariableEnvironment <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// 变量环境</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="this-binding"><a href="#this-binding" class="header-anchor">#</a> This Binding</h4> <p>通过上面的介绍我们知道实际开发主要用到两种执行上下文为<strong>全局</strong>和<strong>函数</strong>, 那么绑定<code>this</code>在这两种上下文中也不同.</p> <ul><li>全局执行上下文中, <code>this</code>指的就是全局对象, 浏览器环境指向<code>window</code>对象, <code>nodejs</code>中指向这个文件的<code>module</code>对象.</li> <li>函数执行上下文较为复杂, <code>this</code>的值取决于函数的调用方式. 具体有: 默认绑定、隐式绑定、显式绑定、<code>new</code>绑定、箭头函数.</li></ul> <h4 id="词法环境"><a href="#词法环境" class="header-anchor">#</a> 词法环境</h4> <p>如上图, <strong>词法环境</strong>是由两个部分<strong>组成</strong>的:</p> <ol><li><strong>环境记录</strong>: 存储变量和函数声明的实际位置;</li> <li><strong>对外部环境的引用</strong>: 用于访问其外部词法环境.</li></ol> <p>同样的, <strong>词法环境</strong>也主要有两种类型:</p> <ol><li><strong>全局环境</strong>: 拥有一个全局对象(window对象)及其关联的所有属性和方法(比如数组的方法<code>splice、concat</code>等), 同时也包含了用户自定义的全局变量. 但是<strong>全局环境</strong>中没有外部环境的引用, 也就是外部环境引用为<code>null</code>.</li> <li><strong>函数环境</strong>: 用户在函数中自定义的变量和函数存储在<strong>环境记录</strong>中, 包含了<code>arguments</code>对象. 而对外部环境的引用可以是<strong>全局环境</strong>， 也可以是另一个<strong>函数环境</strong>(比如一个函数中包含了另一个函数).</li></ol> <p>继续用伪代码来实现:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>GlobalExectionContext <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 全局执行上下文</span>
	<span class="token literal-property property">LexicalEnvironment</span><span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token comment">// 词法环境</span>
		<span class="token literal-property property">EnvironmentRecord</span><span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token comment">// 环境记录</span>
			<span class="token literal-property property">Type</span><span class="token operator">:</span> <span class="token string">"Object"</span>       <span class="token comment">// 全局环境</span>
      <span class="token comment">// 标识符绑定在这里</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">outer</span><span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span>          <span class="token comment">// 外部环境引用</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
FunctionExectionContext <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 函数执行上下文</span>
	<span class="token literal-property property">LexicalEnvironment</span><span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token comment">// 词法环境</span>
		<span class="token literal-property property">EnvironmentRecord</span><span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token comment">// 环境记录</span>
			<span class="token literal-property property">Type</span><span class="token operator">:</span> <span class="token string">"Object"</span><span class="token punctuation">,</span>       <span class="token comment">// 函数环境</span>
			<span class="token comment">// 标识符绑定在这里</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">outer</span><span class="token operator">:</span> <span class="token operator">&lt;</span>Global or FunctionEnvironment<span class="token operator">&gt;</span> <span class="token comment">// 外部环境引用</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="变量环境"><a href="#变量环境" class="header-anchor">#</a> 变量环境</h4> <p><strong>变量环境</strong>其实也是一个词法环境, 因此它具有上面定义的词法环境的所有属性.</p> <p>在 ES6 中，<strong>词法</strong> 环境和 <strong>变量</strong> 环境的区别在于前者用于存储**函数声明和变量（ <code>let</code> 和 <code>const</code> ）<strong>绑定，而后者仅用于存储</strong>变量（ <code>var</code> ）**绑定。</p> <p><strong>案例🌰</strong>:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> a<span class="token punctuation">;</span>
<span class="token keyword">var</span>	b <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> d <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fn</span> <span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span> f</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">var</span> g <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> e <span class="token operator">+</span> f <span class="token operator">+</span> g<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
a <span class="token operator">=</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>执行上下文如下:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>GlobalExectionContext <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 全局执行上下文</span>

	<span class="token literal-property property">ThisBinding</span><span class="token operator">:</span> <span class="token operator">&lt;</span>Global Object<span class="token operator">&gt;</span><span class="token punctuation">,</span>
	
	<span class="token literal-property property">LexicalEnvironment</span><span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token comment">// 词法环境</span>
		<span class="token literal-property property">EnvironmentRecord</span><span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token comment">// 环境记录</span>
			<span class="token literal-property property">Type</span><span class="token operator">:</span> <span class="token string">"Object"</span><span class="token punctuation">,</span>       <span class="token comment">// 全局环境</span>
			<span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token operator">&lt;</span> uninitialized <span class="token operator">&gt;</span><span class="token punctuation">,</span>
  		<span class="token literal-property property">d</span><span class="token operator">:</span> <span class="token operator">&lt;</span> uninitialized <span class="token operator">&gt;</span><span class="token punctuation">,</span>
			<span class="token literal-property property">fn</span><span class="token operator">:</span> <span class="token operator">&lt;</span> func <span class="token operator">&gt;</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token literal-property property">outer</span><span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span>            <span class="token comment">// 外部环境引用</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token literal-property property">VariableEnvironment</span><span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token comment">// 变量环境</span>
    <span class="token literal-property property">EnvironmentRecord</span><span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token comment">// 环境记录</span>
      <span class="token literal-property property">Type</span><span class="token operator">:</span> <span class="token string">"Object"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token operator">&lt;</span> uninitialized <span class="token operator">&gt;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token operator">&lt;</span> uninitialized <span class="token operator">&gt;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">outer</span><span class="token operator">:</span> <span class="token operator">&lt;</span><span class="token keyword">null</span><span class="token operator">&gt;</span>  
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
FunctionExectionContext <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token comment">// 函数执行上下文</span>
  
  <span class="token literal-property property">ThisBinding</span><span class="token operator">:</span> <span class="token operator">&lt;</span>Global Object<span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token comment">// this绑定window, 因为调用fn的是window对象</span>
  
	<span class="token literal-property property">LexicalEnvironment</span><span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token comment">// 词法环境</span>
		<span class="token literal-property property">EnvironmentRecord</span><span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token comment">// 环境记录</span>
			<span class="token literal-property property">Type</span><span class="token operator">:</span> <span class="token string">"Object"</span><span class="token punctuation">,</span>       <span class="token comment">// 函数环境</span>
			<span class="token literal-property property">Arguments</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token number">0</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token literal-property property">length</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">outer</span><span class="token operator">:</span> <span class="token operator">&lt;</span> GlobalLexicalEnvironment <span class="token operator">&gt;</span> <span class="token comment">// 全局环境的引用</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
  
  <span class="token literal-property property">VariableEnvironment</span><span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token comment">// 变量环境</span>
    <span class="token literal-property property">EnvironmentRecord</span><span class="token operator">:</span> <span class="token punctuation">{</span>   <span class="token comment">// 环境记录</span>
      <span class="token literal-property property">Type</span><span class="token operator">:</span> <span class="token string">"Object"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">g</span><span class="token operator">:</span> <span class="token operator">&lt;</span> uninitialized <span class="token operator">&gt;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">outer</span><span class="token operator">:</span> <span class="token operator">&lt;</span> GlobalLexicalEnvironment <span class="token operator">&gt;</span> <span class="token comment">// 全局环境的引用</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>因此我们可以知道<strong>变量提升</strong>的原因是:</p> <blockquote><p>在创建阶段，函数声明存储在环境中，而变量会被设置为 <code>undefined</code>（在 <code>var</code> 的情况下）或保持未初始化（在 <code>let</code> 和 <code>const</code> 的情况下）。所以这就是为什么可以在声明之前访问 <code>var</code> 定义的变量（尽管是 <code>undefined</code> ），但如果在声明之前访问 <code>let</code> 和 <code>const</code> 定义的变量就会提示引用错误的原因。这就是所谓的变量提升。</p></blockquote> <h3 id="执行阶段"><a href="#执行阶段" class="header-anchor">#</a> 执行阶段</h3> <p>执行阶段主要做三件事情:</p> <ol><li>变量赋值</li> <li>函数引用</li> <li>执行其他的代码</li></ol> <p><strong>注⚠️</strong></p> <blockquote><p>如果 Javascript 引擎在源代码中声明的实际位置找不到 <code>let</code> 变量的值，那么将为其分配 <code>undefined</code> 值。</p></blockquote> <h3 id="销毁阶段"><a href="#销毁阶段" class="header-anchor">#</a> 销毁阶段</h3> <p>执行完毕出栈，等待回收被销毁</p></div> <!----> <div class="readMore-wrapper"><span class="readMore">阅读全文</span></div>
                    </div>
                            <p>这是一个信息提示框。</p>
                        </div>

                        <div class="note warning">
                            <div class="note-title"><i class="fas fa-exclamation-triangle"></i> 注意</div>
                            <p>这是一个警告提示框。</p>
                        </div>

                        <div class="note success">
                            <div class="note-title"><i class="fas fa-check-circle"></i> 成功</div>
                            <p>这是一个成功提示框。</p>
                        </div>

                        <h2>代码示例</h2>
                        <pre><code class="language-javascript">// 示例代码
function example() {
    console.log('Hello, FrontendHub!');
}
</code></pre>
                    </div>

                    <!-- 文章底部导航 -->
                    <nav class="article-nav">
                        <a href="#" class="prev-article">
                            <i class="fas fa-chevron-left"></i>
                            <span>上一篇</span>
                        </a>
                        <a href="#" class="next-article">
                            <span>下一篇</span>
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </nav>
                </article>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4><i class="fas fa-code"></i> FrontendHub</h4>
                    <p>专注于前端技术学习与面试准备</p>
                </div>
                <div class="footer-section">
                    <h4>快速链接</h4>
                    <ul>
                        <li><a href="../../index.html">首页</a></li>
                        <li><a href="../index.html#courses">课程体系</a></li>
                        <li><a href="../index.html#resources">学习资源</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 FrontendHub. 用于个人学习使用.</p>
            </div>
        </div>
    </footer>

    <!-- 返回顶部按钮 -->
    <button class="back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script src="../../js/main.js"></script>
    <script src="../../js/content.js"></script>
</body>
</html>

