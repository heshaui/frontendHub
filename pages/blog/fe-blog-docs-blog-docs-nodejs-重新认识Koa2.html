<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="no-referrer">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>重新认识Koa2 - FrontendHub</title>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/content.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="content-page">
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <a href="../../index.html" style="color: inherit; text-decoration: none; display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-code"></i>
                    <span>FrontendHub</span>
                </a>
            </div>
            <button class="nav-toggle" id="navToggle">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <ul class="nav-menu" id="navMenu">
                <li><a href="../../index.html">首页</a></li>
                <li><a href="../index.html#features">特色</a></li>
                <li><a href="../index.html#courses">课程</a></li>
                <li><a href="../index.html#resources">资源</a></li>
            </ul>
        </div>
    </nav>

    <!-- 面包屑导航 -->
    <div class="breadcrumb">
        <div class="container">
            <a href="../../index.html"><i class="fas fa-home"></i> 首页</a>
            <i class="fas fa-chevron-right"></i>
            <span>重新认识Koa2</span>
        </div>
    </div>

    <!-- 主要内容区 -->
    <main class="content-main">
        <div class="container">
            <div class="content-layout">
                <!-- 侧边栏目录 -->
                <aside class="sidebar">
                    <div class="sidebar-sticky">
                        <h3><i class="fas fa-list"></i> 目录</h3>
                        <nav class="toc" id="toc">
                            <!-- 目录将通过JavaScript自动生成 -->
                        </nav>
                    </div>
                </aside>

                <!-- 文章内容 -->
                <article class="article">
                    <header class="article-header">
                        <h1>重新认识Koa2</h1>
                        <div class="article-meta">
                            <span><i class="far fa-calendar"></i> 更新时间：2025-12-23</span>
                            <span><i class="far fa-clock"></i> 阅读时长：约 15 分钟</span>
                        </div>
                    </header>

                    <div class="article-content">
<div class="content__default"><h1 id="一、koa框架介绍以及koa环境搭建"><a href="#一、koa框架介绍以及koa环境搭建" class="header-anchor">#</a> 一、Koa框架介绍以及Koa环境搭建</h1> <h2 id="_1-1-koa-框架介绍"><a href="#_1-1-koa-框架介绍" class="header-anchor">#</a> 1.1 Koa 框架介绍</h2> <blockquote><p><code>Node.js</code> 是一个异步的世界，官方 <code>API</code> 支持的都是 <code>callback</code> 形式的异步编程模型，这 会带来许多问题，例如:</p></blockquote> <ol><li><code>callback</code> 嵌套问题</li> <li>异步函数中可能同步调用 callback 返回 数据，带来不一致性。为了解决以上问题 <code>Koa</code> 出现了</li></ol> <p><strong>Koa -- 基于 Node.js 平台的下一代 web 开发框架</strong></p> <blockquote><p><code>koa</code> 是由 <code>Express</code> 原班人马打造的，致力于成为一个更小、更富有表现力、更健壮的 Web 框架。 使用 <code>koa</code> 编写 <code>web</code> 应用，可以免除重复繁琐的回调函数嵌套， 并极大地提 升错误处理的效率。<code>koa</code> 不在内核方法中绑定任何中间件， 它仅仅提供了一个轻量优雅的 函数库，使得编写 Web 应用变得得心应手。开发思路和 express 差不多，最大的特点就是 可以避免异步嵌套</p></blockquote> <h2 id="_1-2-koa2-x-框架的安装使用"><a href="#_1-2-koa2-x-框架的安装使用" class="header-anchor">#</a> 1.2 Koa2.x 框架的安装使用</h2> <p><strong>1. 安装 Node.js 8.x 以上的版本</strong></p> <blockquote><p>开发 <code>Koa2</code> 之前，<code>Node.js</code> 是有要求的，它要求 <code>Node.js</code> 版本高于 <code>V7.6</code>。因为 <code>node.js 7.6</code> 版本 开始完全支持 <code>async/await</code>，所以才能完全你支持我们的 Koa2`</p></blockquote> <p><strong>2. 安装 Koa</strong></p> <blockquote><p>安装 <code>Koa</code> 框架和我们以前安装其他模块是一样的</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>npm install --save koa / cnpm install --save koa
</code></pre></div><blockquote><p><code>--save</code> 参数，表示自动修改 <code>package.json</code> 文件，自动添加依赖项</p></blockquote> <p><strong>简单使用</strong></p> <p><img src="https://s.poetries.top/gitee/2019/10/494.png" alt=""></p> <h1 id="二、koa-路由-get传值、动态路由"><a href="#二、koa-路由-get传值、动态路由" class="header-anchor">#</a> 二、koa 路由 get传值、动态路由</h1> <h2 id="_2-1-koa-路由"><a href="#_2-1-koa-路由" class="header-anchor">#</a> 2.1 Koa 路由</h2> <ul><li>路由(<code>Routing</code>)是由一个 <code>URI</code>(或者叫路径)和一个特定的 <code>HTTP</code> 方法(<code>GET</code>、<code>POST</code>等)
组成的，涉及到应用如何响应客户端对某个网站节点的访问</li> <li>通俗的讲:路由就是根据不同的 <code>URL</code> 地址，加载不同的页面实现不同的功能</li> <li><code>Koa</code> 中的路由和 <code>Express</code> 有所不同，在 <code>Express</code> 中直接引入 <code>Express</code> 就可以配置路由，但是在 <code>Koa</code> 中我们需要安装对应的 <code>koa-router</code> 路由模块来实现</li></ul> <div class="language- extra-class"><pre class="language-text"><code>npm install --save koa-router
</code></pre></div><p><img src="https://s.poetries.top/gitee/2019/10/495.png" alt=""></p> <h2 id="_2-2-koa-路由-get-传值"><a href="#_2-2-koa-路由-get-传值" class="header-anchor">#</a> 2.2 Koa 路由 get 传值</h2> <blockquote><p>在 <code>koa2</code> 中 <code>GET</code> 传值通过 <code>request</code> 接收，但是接收的方法有两种:<code>query</code> 和 <code>querystring</code></p></blockquote> <ul><li><code>query</code>:返回的是格式化好的参数对象。</li> <li><code>querystring</code>:返回的是请求字符串</li></ul> <p><img src="https://s.poetries.top/gitee/2019/10/496.png" alt=""></p> <h2 id="_2-3-koa-动态路由"><a href="#_2-3-koa-动态路由" class="header-anchor">#</a> 2.3 Koa 动态路由</h2> <p><img src="https://s.poetries.top/gitee/2019/10/497.png" alt=""></p> <h1 id="三、koa-中间件及执行流程"><a href="#三、koa-中间件及执行流程" class="header-anchor">#</a> 三、koa 中间件及执行流程</h1> <h2 id="_3-1-koa中间件的洋葱图执行流程"><a href="#_3-1-koa中间件的洋葱图执行流程" class="header-anchor">#</a> 3.1 koa中间件的洋葱图执行流程</h2> <p><img src="https://s.poetries.top/gitee/2019/10/498.gif" alt=""></p> <h2 id="_3-2-koa-中间件"><a href="#_3-2-koa-中间件" class="header-anchor">#</a> 3.2 koa 中间件</h2> <h3 id="_3-2-1-什么是-koa-的中间件"><a href="#_3-2-1-什么是-koa-的中间件" class="header-anchor">#</a> 3.2.1 什么是 Koa 的中间件</h3> <ul><li>通俗的讲:中间件就是匹配路由之前或者匹配路由完成做的一系列的操作，我们就可以
把它叫做中间件</li> <li>在<code>express</code>中间件(<code>Middleware</code>)是一个函数，它可以访问请求对象(request object (req)), 响应对象(<code>response object (res)</code>), 和 <code>web</code> 应用中处理请求-响应循环流程中的中间件，一 般被命名为 next 的变量。在 <code>Koa</code> 中中间件和 <code>express</code> 有点类似。</li></ul> <p><strong>中间件的功能包括</strong></p> <ul><li>执行任何代码</li> <li>修改请求和响应对象</li> <li>终结请求-响应循环</li> <li>调用堆栈中的下一个中间件</li></ul> <blockquote><p>如果我的 <code>get</code>、<code>post</code> 回调函数中，没有 <code>next</code> 参数，那么就匹配上第一个路由，就不会往下匹 配了。如果想往下匹配的话，那么需要写 <code>next()</code></p></blockquote> <h3 id="_3-2-2-koa-应用可使用如下几种中间件"><a href="#_3-2-2-koa-应用可使用如下几种中间件" class="header-anchor">#</a> 3.2.2 Koa 应用可使用如下几种中间件</h3> <p><strong>1. 应用级中间件</strong></p> <p><img src="https://s.poetries.top/gitee/2019/10/499.png" alt=""></p> <p><strong>2. 路由中间件</strong></p> <p><img src="https://s.poetries.top/gitee/2019/10/500.png" alt=""></p> <p><strong>3. 错误处理中间件</strong></p> <p><img src="https://s.poetries.top/gitee/2019/10/501.png" alt=""></p> <p><strong>4. 第三方中间件</strong></p> <p><img src="https://s.poetries.top/gitee/2019/10/502.png" alt=""></p> <h3 id="_3-2-3-koa-中间件的执行顺序"><a href="#_3-2-3-koa-中间件的执行顺序" class="header-anchor">#</a> 3.2.3 Koa 中间件的执行顺序</h3> <blockquote><p><code>Koa</code> 的中间件和 <code>Express</code> 不同，<code>Koa</code> 选择了洋葱圈模型</p></blockquote> <p><img src="https://s.poetries.top/gitee/2019/10/503.png" alt=""></p> <h1 id="四、koa-ejs模板引擎使用-以及ejs配置全局数据"><a href="#四、koa-ejs模板引擎使用-以及ejs配置全局数据" class="header-anchor">#</a> 四、koa ejs模板引擎使用 以及ejs配置全局数据</h1> <p><strong>1. 安装 koa-views 和 ejs</strong></p> <ul><li>安装 <code>koa-views npm install --save koa-views / cnpm install --save koa-views</code></li> <li>安装 <code>ejs npm install ejs --save / cnpm install ejs --save</code></li></ul> <p><strong>2. 引入 koa-views 配置中间件</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> views <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-views'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">views</span><span class="token punctuation">(</span><span class="token string">'views'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">map</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token literal-property property">html</span><span class="token operator">:</span> <span class="token string">'ejs'</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>3. Koa 中使用 ejs</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/add'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> 
    <span class="token keyword">let</span> title <span class="token operator">=</span> <span class="token string">'hello koa2'</span> 
    
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>index'<span class="token punctuation">,</span><span class="token punctuation">{</span> title <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>4. Ejs 引入模板</strong></p> <div class="language- extra-class"><pre class="language-text"><code>&lt;%- include header.ejs %&gt;
</code></pre></div><p><strong>5. Ejs 绑定数据</strong></p> <div class="language- extra-class"><pre class="language-text"><code>&lt;%=h%&gt;
</code></pre></div><p><strong>6. Ejs 绑定 html 数据</strong></p> <div class="language- extra-class"><pre class="language-text"><code>&lt;%-h%&gt;
</code></pre></div><p><strong>7. Ejs 模板判断语句</strong></p> <div class="language-html extra-class"><pre class="language-html"><code>&lt;% if(true){ %&gt;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
&lt;%} else{ %&gt;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
&lt;%} %&gt;
</code></pre></div><p><strong>8. Ejs 模板中循环数据</strong></p> <div class="language-html extra-class"><pre class="language-html"><code>&lt;%for(var i=0;i<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list.length;i++)</span> <span class="token attr-name">{</span> <span class="token attr-name">%</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>&lt;%=list[i] %&gt;<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
&lt;%}%&gt;
</code></pre></div><h1 id="五、koa-post-提交数据-koa-bodyparser-中间件的使用"><a href="#五、koa-post-提交数据-koa-bodyparser-中间件的使用" class="header-anchor">#</a> 五、koa post 提交数据 koa-bodyparser 中间件的使用</h1> <h2 id="_5-1-原生-nodejs-获取-post-提交数据"><a href="#_5-1-原生-nodejs-获取-post-提交数据" class="header-anchor">#</a> 5.1 原生 Nodejs 获取 post 提交数据</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">parsePostData</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span><span class="token punctuation">{</span>
            <span class="token keyword">let</span> postdata<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>
            ctx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                postdata <span class="token operator">+=</span> data
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            ctx<span class="token punctuation">.</span>req<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"end"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>postdata<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_5-2-koa-中-koa-bodyparser-中间件的使用"><a href="#_5-2-koa-中-koa-bodyparser-中间件的使用" class="header-anchor">#</a> 5.2 Koa 中 koa-bodyparser 中间件的使用</h2> <p><strong>1. 安装 koa-bodyparser</strong></p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save koa-bodyparser
</code></pre></div><p><strong>2. 安装 引入配置中间件</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-bodyparser'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">ctx</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>3. 使用</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body <span class="token comment">// 获取 post 提交的数据</span>
</code></pre></div><h1 id="六、koa-static静态资源中间件"><a href="#六、koa-static静态资源中间件" class="header-anchor">#</a> 六、koa-static静态资源中间件</h1> <p><strong>1. 安装 koa-static</strong></p> <div class="language- extra-class"><pre class="language-text"><code>npm install --save koa-static
</code></pre></div><p><strong>2. 引入配置中间件</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token keyword">static</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-static'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">static</span><span class="token punctuation">(</span>
    path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span> __dirname<span class="token punctuation">,</span> <span class="token string">'public'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h1 id="七、koa-art-template高性能模板引擎的使用"><a href="#七、koa-art-template高性能模板引擎的使用" class="header-anchor">#</a> 七、koa art-template高性能模板引擎的使用</h1> <h2 id="_7-1-常见模板引擎的性能对比"><a href="#_7-1-常见模板引擎的性能对比" class="header-anchor">#</a> 7.1 常见模板引擎的性能对比</h2> <blockquote><p>适用于 <code>koa</code> 的模板引擎选择非常多，比如 <code>jade</code>、<code>ejs</code>、<code>nunjucks</code>、<code>art-template</code> 等</p></blockquote> <ul><li><code>art-template</code> 是一个简约、超快的模板引擎</li> <li>它采用作用域预声明的技术来优化模板渲染速度，从而获得接近 JavaScript 极限的运行 性能，并且同时支持 NodeJS 和浏览器。</li> <li><code>art-template</code> 支持 <code>ejs</code> 的语法，也可以用自己的类似 <code>angular</code> 数据绑定的语法</li> <li>中文文档: http://aui.github.io/art-template/zh-cn/docs</li></ul> <p><img src="https://s.poetries.top/gitee/2019/10/504.png" alt=""></p> <p><img src="https://s.poetries.top/gitee/2019/10/505.png" alt=""></p> <h2 id="_7-2-在-koa-中使用-art-template-模板引擎"><a href="#_7-2-在-koa-中使用-art-template-模板引擎" class="header-anchor">#</a> 7.2 在 Koa 中使用 art-template 模板引擎</h2> <div class="language- extra-class"><pre class="language-text"><code> npm install --save art-template 
 npm install --save koa-art-template
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> render <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'koa-art-template'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">render</span><span class="token punctuation">(</span>app<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">root</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'view'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token literal-property property">extname</span><span class="token operator">:</span> <span class="token string">'.art'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">debug</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> ctx<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8080</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_7-3-art-template-模板引擎语法"><a href="#_7-3-art-template-模板引擎语法" class="header-anchor">#</a> 7.3 art-template 模板引擎语法</h2> <blockquote><p>参考:http://aui.github.io/art-template/zh-cn/docs/syntax.html</p></blockquote> <h1 id="八、koa-cookie的使用"><a href="#八、koa-cookie的使用" class="header-anchor">#</a> 八、koa Cookie的使用</h1> <h2 id="_8-1-koa-cookie-的使用"><a href="#_8-1-koa-cookie-的使用" class="header-anchor">#</a> 8.1 Koa Cookie 的使用</h2> <p><strong>1. Koa 中设置 Cookie 的值</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>通过 <code>options</code> 设置 <code>cookie name</code> 的 <code>value</code></p></blockquote> <p><img src="https://s.poetries.top/gitee/2019/10/506.png" alt=""></p> <p><strong>2. Koa 中获取 Cookie 的值</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>ctx<span class="token punctuation">.</span>cookies<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_8-2-koa-中设置中文-cookie"><a href="#_8-2-koa-中设置中文-cookie" class="header-anchor">#</a> 8.2 Koa 中设置中文 Cookie</h2> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'hello, world!'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 转换成 base64 字符 串:aGVsbG8sIHdvcmxkIQ==</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Buffer</span><span class="token punctuation">(</span><span class="token string">'aGVsbG8sIHdvcmxkIQ=='</span><span class="token punctuation">,</span> <span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 还原 base 64 字符串:hello, world!</span>
</code></pre></div><h1 id="九、koa-session-的使用"><a href="#九、koa-session-的使用" class="header-anchor">#</a> 九、koa Session 的使用</h1> <h2 id="_9-1-session-简单介绍"><a href="#_9-1-session-简单介绍" class="header-anchor">#</a> 9.1 Session 简单介绍</h2> <blockquote><p><code>session</code> 是另一种记录客户状态的机制，不同的是 <code>Cookie</code> 保存在客户端浏览器中，而 <code>session</code> 保存在服务器上</p></blockquote> <h2 id="_9-2-session-的工作流程"><a href="#_9-2-session-的工作流程" class="header-anchor">#</a> 9.2 Session 的工作流程</h2> <blockquote><p>当浏览器访问服务器并发送第一次请求时，服务器端会创建一个 <code>session</code> 对象，生 成一个类似于 <code>key</code>,<code>value</code> 的键值对， 然后将<code>key(cookie)</code>返回到浏览器(客户)端，浏览 器下次再访问时，携带 <code>key(cookie)</code>，找到对应的 <code>session(value)</code>。 客户的信息都保存 在 <code>session</code> 中</p></blockquote> <h2 id="_9-3-koa-session-的使用"><a href="#_9-3-koa-session-的使用" class="header-anchor">#</a> 9.3 koa-session 的使用</h2> <p><strong>1. 安装 express-session</strong></p> <div class="language- extra-class"><pre class="language-text"><code>npm install koa-session --save
</code></pre></div><p><strong>2. 引入 express-session</strong></p> <div class="language- extra-class"><pre class="language-text"><code>const session = require('koa-session');
</code></pre></div><p><strong>3. 设置官方文档提供的中间件</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'some secret hurr'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">CONFIG</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">key</span><span class="token operator">:</span> <span class="token string">'koa:sess'</span><span class="token punctuation">,</span> <span class="token comment">//cookie key (default is koa:sess)</span>
    <span class="token literal-property property">maxAge</span><span class="token operator">:</span> <span class="token number">86400000</span><span class="token punctuation">,</span> <span class="token comment">// cookie 的过期时间 maxAge in ms (default is 1 days)</span>
    <span class="token literal-property property">overwrite</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//是否可以 overwrite (默认 default true)</span>
    <span class="token literal-property property">httpOnly</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//cookie 是否只有服务器端可以访问 httpOnly or not (default true)</span>
    <span class="token literal-property property">signed</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">//签名默认 true</span>
    <span class="token literal-property property">rolling</span><span class="token operator">:</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//在每次请求时强行设置cookie，这将重置cookie过期时间(默认:false)</span>
    <span class="token literal-property property">renew</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">//(boolean) renew session when session is nearly expired</span>
<span class="token punctuation">}</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>4. 使用</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//设置值 </span>
ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username <span class="token operator">=</span> <span class="token string">"张三"</span><span class="token punctuation">;</span>

<span class="token comment">// 获取值 </span>
ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username
</code></pre></div><h2 id="_9-4-cookie-和-session-区别"><a href="#_9-4-cookie-和-session-区别" class="header-anchor">#</a> 9.4 Cookie 和 Session 区别</h2> <ul><li><code>cookie</code> 数据存放在客户的浏览器上，<code>session</code> 数据放在服务器上</li> <li><code>cookie</code> 不是很安全，别人可以分析存放在本地的 <code>COOKIE</code> 并进行 <code>COOKIE</code> 欺骗 考虑到安全应当使用 <code>session</code></li> <li><code>session</code>会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能 考虑到减轻服务器性能方面，应当使用 <code>COOKIE</code></li> <li>单个 <code>cookie</code> 保存的数据不能超过 <code>4K</code>，很多浏览器都限制一个站点最多保存 <code>20</code> 个 <code>cookie</code></li></ul> <h1 id="十、koa-操作-mongodb-数据库"><a href="#十、koa-操作-mongodb-数据库" class="header-anchor">#</a> 十、Koa 操作 Mongodb 数据库</h1> <blockquote><p>官方文档:http://mongodb.github.io/node-mongodb-native/</p></blockquote> <h1 id="十一、koa-应用生成器以及-koa-路由模-块化"><a href="#十一、koa-应用生成器以及-koa-路由模-块化" class="header-anchor">#</a> 十一、Koa 应用生成器以及 Koa 路由模 块化</h1> <h2 id="_11-1-koa-应用生成器"><a href="#_11-1-koa-应用生成器" class="header-anchor">#</a> 11.1 koa 应用生成器</h2> <blockquote><p>通过应用 <code>koa</code> 脚手架生成工具 可以快速创建一个基于 <code>koa2</code> 的应用的骨架</p></blockquote> <p><strong>1. 全局安装</strong></p> <div class="language- extra-class"><pre class="language-text"><code>npm install koa-generator -g
</code></pre></div><p><strong>2. 创建项目</strong></p> <div class="language- extra-class"><pre class="language-text"><code>koa koa_demo
</code></pre></div><p><strong>3. 安装依赖</strong></p> <div class="language- extra-class"><pre class="language-text"><code>cd koa_demo

npm install
</code></pre></div><p><strong>4. 启动项目</strong></p> <div class="language- extra-class"><pre class="language-text"><code>npm start
</code></pre></div><h2 id="_11-2-koa-搭建模块化路由-层级路由"><a href="#_11-2-koa-搭建模块化路由-层级路由" class="header-anchor">#</a> 11.2 koa 搭建模块化路由/层级路由</h2> <ol><li>在目录下面新建一个文件夹 <code>routes</code></li> <li>在 <code>routes</code> 里面配置对应的子页面</li> <li>比如在 <code>routes</code> 新建 <code>index.js</code></li></ol> <p><img src="https://s.poetries.top/gitee/2019/10/507.png" alt=""></p> <ol start="4"><li>然后在主应用中加载子路由模块:</li></ol> <p><img src="https://s.poetries.top/gitee/2019/10/508.png" alt=""></p></div> <!----> <div class="readMore-wrapper"><span class="readMore">阅读全文</span></div>
                    </div>
                            <p>这是一个信息提示框。</p>
                        </div>

                        <div class="note warning">
                            <div class="note-title"><i class="fas fa-exclamation-triangle"></i> 注意</div>
                            <p>这是一个警告提示框。</p>
                        </div>

                        <div class="note success">
                            <div class="note-title"><i class="fas fa-check-circle"></i> 成功</div>
                            <p>这是一个成功提示框。</p>
                        </div>

                        <h2>代码示例</h2>
                        <pre><code class="language-javascript">// 示例代码
function example() {
    console.log('Hello, FrontendHub!');
}
</code></pre>
                    </div>

                    <!-- 文章底部导航 -->
                    <nav class="article-nav">
                        <a href="#" class="prev-article">
                            <i class="fas fa-chevron-left"></i>
                            <span>上一篇</span>
                        </a>
                        <a href="#" class="next-article">
                            <span>下一篇</span>
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    </nav>
                </article>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4><i class="fas fa-code"></i> FrontendHub</h4>
                    <p>专注于前端技术学习与面试准备</p>
                </div>
                <div class="footer-section">
                    <h4>快速链接</h4>
                    <ul>
                        <li><a href="../../index.html">首页</a></li>
                        <li><a href="../index.html#courses">课程体系</a></li>
                        <li><a href="../index.html#resources">学习资源</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 FrontendHub. 用于个人学习使用.</p>
            </div>
        </div>
    </footer>

    <!-- 返回顶部按钮 -->
    <button class="back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </button>

    <script src="../../js/main.js"></script>
    <script src="../../js/content.js"></script>
</body>
</html>

