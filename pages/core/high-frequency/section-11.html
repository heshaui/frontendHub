<!-- Section: # 11 综合题目 -->
<div class="section-content" data-section-id="_11-综合题目">
<h2 id="_11-综合题目"><a href="#_11-综合题目" class="header-anchor">#</a> 11 综合题目</h2>
<h3 id="你们的工作流程是怎么样的"><a href="#你们的工作流程是怎么样的" class="header-anchor">#</a> 你们的工作流程是怎么样的</h3>
<p><strong>流程图</strong></p>
<p>下图是完整的大厂前端项目研发流程图</p>
<p><img alt="" src="https://s.poetries.top/uploads/2023/02/7d1c0a6aff18214a.png"></p>
<p><strong>项目角色</strong></p>
<ul><li>项目委员会：这是一个很虚的角色，即能确定项目是否要做的那帮人，有时候可能就是一个高级经理就能拍板确定。和我们实际开发没啥关系，不用去关心他。</li> <li><code>PM</code>：产品经理，也是一个项目的推动者，即兼职项目经理的角色。</li> <li><code>UE</code>：交互设计师，负责页面布局、交互的设计，不负责视图的细节。</li> <li><code>UI</code>：视觉设计师，交互确定之后，设计页面样式。注意，很多情况下，<code>UE</code> 和 <code>UI</code> 是一个人。</li> <li><code>RD</code>：后端开发人员。</li> <li><code>CRD</code>：客户端开发人员，安卓和 <code>ios</code> 都是。</li> <li><code>FE</code>：前端开发人员。</li> <li><code>QA</code>：测试人员。</li> <li><code>OP</code>：服务器运维人员，一般负责审批上线单</li></ul>
<p><strong>主要流程</strong></p>
<p><strong>项目立项</strong></p>
<ul><li>主要是各个部门的 <code>leader</code> 确定项目要做了，就是“拍板儿”确定。此时不需要工程师参与，因为决定权在于他们。项目立项时没有任何详细的信息，如需求、设计图等，都要后面继续做。</li> <li><strong>编写需求和需求评审</strong> <ul><li><code>PM</code> 根据项目的背景和目标，编写需求文档，画原型图（不是 <code>UI</code> 设计图），然后叫各个角色开会评审。</li> <li>你如果作为 <code>FE</code> 角色去参与评审，要积极提出自己的问题和建议。需求评审不一定一次通过。</li> <li>如果此时 <code>PM</code> 跟你要工作排期，你不要立即回复。回去跟你的 <code>leader</code> 商量之后，给一个谨慎的排期。</li></ul></li> <li><strong>编写技术方案</strong> <ul><li>需求指导设计，设计指导开发。先做技术方案设计，写文档，待评审之后再开发。</li></ul></li> <li><strong>技术方案评审</strong> <ul><li>技术方案写完之后，要叫 <code>leader</code> ，以及其他技术角色人员一起评审。
<ul><li>第一，和其他技术人员确定接口格式，是否都能认同</li> <li>第二，让 <code>leader</code> 或者架构师确定这个设计有没有漏洞、安全问题等</li></ul></li></ul></li> <li><strong>交互视觉设计和评审</strong> <ul><li>需求评审通过之后，<code>UE</code> 和 <code>UI</code> 就开始出设计稿。做完设计稿之后，会叫相关开发人员参与评审。和需求评审一样，你要提出自己的问题和建议。</li></ul></li> <li><strong>开发</strong> <ul><li>上述评审都结束之后，才可以进入开发阶段。开发时要注意开发规范，及时 <code>code review</code>，写单元测试。</li></ul></li> <li><strong>视觉联调</strong> <ul><li>网页界面开发完成之后，要找 <code>UI</code> 人员来视觉联调，让他们确认是否可以。如果不可以，就直接修改，直到评审通过。</li> <li>这一步要尽早执行，不要等待临上线了，再去调整 <code>UI</code> 界面。</li></ul></li> <li><strong>程序联调</strong> <ul><li>代码功能开发完之后，要和其他相关技术人员（<code>RD</code>、<code>CRD</code>）进行接口联调。就是在开发环境下，先把系统对接起来，看看会不会出错。</li> <li>注意，接口联调不是测试，不用太过于项目，能把最基本的功能跑通即可。</li></ul></li> <li><strong>自测</strong> <ul><li>对于自己开发的功能，一定要自己按照需求测试一遍。不要求测试的很详细，至少也把基本功能跑通。</li> <li>这一步是为了防止提测之后被 <code>QA</code> 发现基本功能不可用，就很尴尬。人家会觉得你不靠谱。</li></ul></li> <li><strong>提测</strong> <ul><li>自测完成之后，即可把代码提测给 <code>QA</code> 。这一步很关键，要发邮件，抄送给项目组的相关成员。</li></ul></li> <li><strong>测试</strong> <ul><li><code>QA</code> 进行详细的功能测试。测试期间会有 <code>bug</code> 反馈，要及时修复 <code>bug</code> ，并及时让 <code>QA</code> 回归测试。</li> <li>测试期间要积极和 <code>QA</code> 沟通，最好每天都开一个站会。</li></ul></li> <li><strong>上线 &amp; 回归测试</strong> <ul><li><code>QA</code> 测试完成会发邮件全体通报测试通过，测试就可以准备上线。</li> <li>上线之后要及时和 <code>QA</code> 组织回归测试，待回归测试完成之后才可以通知：上线完成</li></ul></li> <li><strong>项目总结（可选）</strong> <ul><li>回顾一下经过，总结一下得失，积累一点经验，这样才能慢慢成长</li></ul></li></ul>
<h3 id="工作中遇到过哪些项目难点-是如何解决的"><a href="#工作中遇到过哪些项目难点-是如何解决的" class="header-anchor">#</a> 工作中遇到过哪些项目难点，是如何解决的</h3>
<p><strong>遇到问题要注意积累</strong></p>
<ul><li>每个人都会遇到问题，总有几个问题让你头疼</li> <li>日常要注意积累，解决了问题要自己写文章复盘</li></ul>
<p><strong>如果之前没有积累</strong></p>
<ul><li>回顾一下半年之内遇到的难题</li> <li>思考当时解决方案，以及解决之后的效果</li> <li>写一篇文章记录一下，答案就有了</li></ul>
<p><strong>答案模板</strong></p>
<ul><li>描述问题：背景 + 现象 + 造成的影响</li> <li>问题如何被解决：分析 + 解决</li> <li>自己的成长：学到了什么 + 以后如何避免</li></ul>
<p><strong>一个示例</strong></p>
<ul><li>问题：编辑器只能回显JSON格式的数据，而不支持老版本的HTML格式</li> <li>解决：将老版本的HTML反解析成JSON格式即可解决</li> <li>成长：要考虑完整的输入输出 + 考虑旧版本用户 + 参考其他产品</li></ul>
<h3 id="前端性能优化"><a href="#前端性能优化" class="header-anchor">#</a> 前端性能优化</h3>
<p><strong>前言</strong></p>
<ul><li>是一个综合性问题，没有标准答案，但要求尽量全面</li> <li>某些细节可能会问：防抖、节流等</li></ul>
<p><strong>性能优化原则</strong></p>
<ul><li>多使用内存、缓存或其他方法</li> <li>减少<code>CPU</code>计算量，减少网络加载耗时</li></ul>
<p><strong>从何入手</strong></p>
<ul><li><strong>让加载更快</strong> <ul><li>减少资源体积：压缩代码</li> <li>减少访问次数：合并代码，<code>SSR</code>服务端渲染，缓存
<ul><li><strong>SSR</strong> <ul><li>服务端渲染：将网页和数据一起加载，一起渲染</li> <li>非<code>SSR</code>模式（前后端分离）：先加载网页，在加载数据，在渲染数据</li></ul></li> <li><strong>缓存</strong> <ul><li>静态资源加<code>hash</code>后缀，根据文件内容计算<code>hash</code></li> <li>文件内容不变，则<code>hash</code>不变，则<code>url</code>不变</li> <li><code>url</code>和文件不变，则会自动触发<code>http</code>缓存机制，返回<code>304</code> <img alt="" src="https://s.poetries.top/uploads/2023/02/3a284db5c7da6390.png"></li></ul></li></ul></li> <li>减少请求时间：<code>DNS</code>预解析，<code>CDN</code>，<code>HTTP2</code> <ul><li><strong>DNS预解析</strong> <ul><li><code>DNS</code>解析：将域名解析为<code>IP</code>地址</li> <li><code>DNS</code>预解析：提前解析域名，将域名解析为<code>IP</code>地址</li> <li><code>DNS</code>预解析的方式：<code>&lt;link rel="dns-prefetch" href="https://interview.poetries.top//www.baidu.com"&gt;</code></li></ul></li> <li><strong>CDN</strong> <ul><li><code>CDN</code>：内容分发网络，将资源分发到离用户最近的服务器上</li> <li><code>CDN</code>的优点：加快资源加载速度，减少服务器压力</li> <li><code>CDN</code>的缺点：增加了网络延迟，增加了服务器成本
<img alt="" src="https://s.poetries.top/uploads/2023/02/e81a3bb1769d3e74.png"></li></ul></li> <li><strong>HTTP2</strong> <ul><li><code>HTTP2</code>：<code>HTTP</code>协议的下一代版本</li> <li><code>HTTP2</code>的优点：多路复用，二进制分帧，头部压缩，服务器推送</li></ul></li></ul></li></ul></li> <li><strong>让渲染更快</strong> <ul><li><code>CSS</code>放在<code>head</code>，<code>JS</code>放在<code>body</code>下面</li> <li>尽早开始执行<code>JS</code>，用<code>DOMContentLoaded</code>触发</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 页面的全部资源加载完才会执行，包括图片、视频等</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// DOM渲染完才执行，此时图片、视频等可能还没有加载完</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>懒加载（图片懒加载，上滑加载更多）
<img alt="" src="https://s.poetries.top/uploads/2023/02/8f0de9086d90c75c.png"></li> <li>对<code>DOM</code>查询进行缓存
<img alt="" src="https://s.poetries.top/uploads/2023/02/93d7e1f458b5b1a1.png"></li> <li>频繁<code>DOM</code>操作，合并到一起插入到<code>DOM</code>结构
<img alt="" src="https://s.poetries.top/uploads/2023/02/5b7fc06e1aef4c9f.png"></li> <li>节流、防抖，让渲染更流畅
<ul><li><strong>防抖</strong> <ul><li>防抖动是将多次执行变为<code>最后一次执行</code></li> <li>适用于：<code>input</code>、<code>click</code>等</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span>
<span class="token comment">// 防抖</span>
<span class="token keyword">function</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">500</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// timer 是闭包中的</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token comment">// 这里返回的函数是每次用户实际调用的防抖函数</span>
  <span class="token comment">// 如果已经设定过定时器了就清空上一次的定时器</span>
  <span class="token comment">// 开始一个新的定时器，延迟执行用户传入的方法</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
      timer <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'keyup'</span><span class="token punctuation">,</span> <span class="token function">debounce</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>target<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><strong>节流</strong> <ul><li>节流是将多次执行变成<code>每隔一段时间执行</code></li> <li>适用于：<code>resize</code>、<code>scroll</code>、<code>mousemove</code>等</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span>
<span class="token comment">// 节流</span>
<span class="token keyword">function</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token parameter">fn<span class="token punctuation">,</span> delay <span class="token operator">=</span> <span class="token number">100</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token keyword">null</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>timer<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 当前有任务了，直接返回</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
      timer <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> delay<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 拖拽</span>
div<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'drag'</span><span class="token punctuation">,</span> <span class="token function">throttle</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>offsetX<span class="token punctuation">,</span> e<span class="token punctuation">.</span>offsetY<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div></li></ul></li></ul></li></ul>
<h3 id="前端常用的设计模式和使用场景"><a href="#前端常用的设计模式和使用场景" class="header-anchor">#</a> 前端常用的设计模式和使用场景</h3>
<ul><li><strong>工厂模式</strong> <ul><li>用一个工厂函数来创建实例，使用的时候隐藏<code>new</code>，可在工厂函数中使用<code>new</code>（<code>function factory(a,b,c) {return new Foo()}</code>）</li> <li>如<code>jQuery</code>的<code>$</code>函数：<code>$</code>等于是在内部使用了<code>new JQuery</code>实例（用工厂函数<code>$</code>包裹了一下），可以直接使用<code>$(div)</code></li> <li><code>react</code>的<code>createElement</code></li></ul></li> <li><strong>单例模式</strong> <ul><li>全局唯一的实例（无法生成第二个）</li> <li>如<code>Vuex</code>、<code>Redux</code>的<code>store</code></li> <li>如全局唯一的<code>dialog</code>、<code>modal</code></li> <li>演示<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 通过class实现单例构造器</span>
<span class="token keyword">class</span> <span class="token class-name">Singleton</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> instance
  <span class="token keyword">private</span> <span class="token function">contructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>instance
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 通过闭包实现单例构造器</span>
<span class="token keyword">const</span> Singleton <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 隐藏Class的构造函数，避免多次实例化</span>
  <span class="token keyword">function</span> <span class="token function">FooService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// 未初始化的单例对象</span>
  <span class="token keyword">let</span> fooService<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token comment">// 创建/获取单例对象的函数</span>
    <span class="token comment">// 通过暴露一个 getInstance() 方法来创建/获取唯一实例</span>
    <span class="token function-variable function">getInstance</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fooService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fooService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FooService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> fooService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 使用</span>
<span class="token keyword">const</span> s1 <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> s2 <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// s1 === s2 // 都是同一个实例</span>
</code></pre></div></li></ul></li> <li><strong>代理模式</strong> <ul><li>使用者不能直接访问对象，而是访问一个代理层</li> <li>在代理层可以监听<code>get</code> <code>set</code>做很多事</li> <li>如<code>ES6 Proxy</code>实现<code>Vue3</code>响应式</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>receiver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Refect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>receiver<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value<span class="token punctuation">,</span>receiver</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Refect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span>key<span class="token punctuation">,</span>value<span class="token punctuation">,</span>receiver<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div></li> <li><strong>观察者模式</strong> <ul><li>观察者模式（基于发布订阅模式）有观察者，也有被观察者</li> <li><strong>观察者需要放到被观察者中，被观察者的状态变化需要通知观察者</strong> 我变化了，内部也是基于发布订阅模式，收集观察者，状态变化后要主动通知观察者</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Subject</span> <span class="token punctuation">{</span> <span class="token comment">// 被观察者 学生</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token string">'happy'</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>observers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 存储所有的观察者</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 收集所有的观察者</span>
  <span class="token function">attach</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// Subject. prototype. attch</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 更新被观察者 状态的方法</span>
  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token parameter">newState</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> newState<span class="token punctuation">;</span> <span class="token comment">// 更新状态</span>
    <span class="token comment">// this 指被观察者 学生</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">o</span> <span class="token operator">=&gt;</span> o<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 通知观察者 更新它们的状态</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Observer</span><span class="token punctuation">{</span> <span class="token comment">// 观察者 父母和老师</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
  <span class="token punctuation">}</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">student</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'当前'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">'被通知了'</span><span class="token punctuation">,</span> <span class="token string">'当前学生的状态是'</span> <span class="token operator">+</span> student<span class="token punctuation">.</span>state<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> student <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Subject</span><span class="token punctuation">(</span><span class="token string">'学生'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> parent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token string">'父母'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token keyword">let</span> teacher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span><span class="token string">'老师'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

<span class="token comment">// 被观察者存储观察者的前提，需要先接纳观察者</span>
student<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span> 
student<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>teacher<span class="token punctuation">)</span><span class="token punctuation">;</span> 
student<span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token string">'被欺负了'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><strong>发布订阅模式</strong> <ul><li>发布订阅者模式，一种对象间一对多的依赖关系，当一个对象的状态发生改变时，所依赖它的对象都将得到状态改变的通知。</li> <li><strong>主要的作用(优点)：</strong> <ul><li>广泛应用于异步编程中(替代了传递回调函数)</li> <li>对象之间松散耦合的编写代码</li></ul></li> <li><strong>缺点：</strong> <ul><li>创建订阅者本身要消耗一定的时间和内存</li> <li>多个发布者和订阅者嵌套一起的时候，程序难以跟踪维护</li></ul></li> <li><strong>发布订阅者模式和观察者模式的区别？</strong> <ul><li>发布/订阅模式是观察者模式的一种变形，两者区别在于，<strong>发布/订阅模式在观察者模式的基础上，在目标和观察者之间增加一个调度中心。</strong></li> <li><strong>观察者模式</strong>是由具体目标调度，比如当事件触发，<code>Subject</code> 就会去调用观察者的方法，所以观察者模式的订阅者与发布者之间是存在依赖的（互相认识的）。</li> <li><strong>发布/订阅模式</strong>由统一调度中心调用，因此发布者和订阅者不需要知道对方的存在（<code>publisher</code>和<code>subscriber</code>是不认识的，中间有个<code>Event Channel</code>隔起来了）</li> <li>总结一下：
<ul><li>观察者模式：<code>Subject</code>和<code>Observer</code>直接绑定，没有中间媒介。如<code>addEventListener</code>直接绑定事件</li> <li>发布订阅模式：<code>publisher</code>和<code>subscriber</code>互相不认识，需要有中间媒介<code>Event Channel</code>。如<code>EventBus</code>自定义事件
<img alt="" src="https://s.poetries.top/uploads/2023/01/15a98c64893feadc.png"></li></ul></li></ul></li> <li><strong>实现的思路：</strong> <ul><li>创建一个对象(缓存列表)</li> <li><code>on</code>方法用来把回调函数<code>fn</code>都加到缓存列表中</li> <li><code>emit</code> 根据<code>key</code>值去执行对应缓存列表中的函数</li> <li><code>off</code>方法可以根据<code>key</code>值取消订阅</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">EventEmiter</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 事件对象，存放订阅的名字和事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 订阅事件的方法</span>
  <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span>callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_events <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 合并之前订阅的cb</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>callback<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 触发事件的方法</span>
  <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span> <span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 遍历执行所有订阅的事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token operator">=&gt;</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">off</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span>cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 删除订阅的事件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_events<span class="token punctuation">[</span>eventName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token operator">=&gt;</span>fn <span class="token operator">!=</span> cb <span class="token operator">&amp;&amp;</span> fn<span class="token punctuation">.</span>l <span class="token operator">!=</span> cb<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 绑定一次 触发后将绑定的移除掉 再次触发掉</span>
  <span class="token function">once</span><span class="token punctuation">(</span><span class="token parameter">eventName<span class="token punctuation">,</span>callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">one</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token comment">// 等callback执行完毕在删除</span>
      <span class="token function">callback</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span>one<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    one<span class="token punctuation">.</span>l <span class="token operator">=</span> callback <span class="token comment">// 自定义属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>eventName<span class="token punctuation">,</span>one<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 测试用例</span>
<span class="token keyword">let</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventEmiter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">let</span> <span class="token function-variable function">login1</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'login success1'</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> <span class="token function-variable function">login2</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'login success2'</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// event.on('login',login1)</span>
event<span class="token punctuation">.</span><span class="token function">once</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span>login2<span class="token punctuation">)</span>
event<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span>login1<span class="token punctuation">)</span> <span class="token comment">// 解除订阅</span>
event<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
event<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">)</span>
event<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'login'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span>  
</code></pre></div></li></ul></li> <li><strong>装饰器模式</strong> <ul><li>原功能不变，增加一些新功能（<code>AOP</code>面向切面编程）</li> <li><code>ES</code>和<code>TS</code>的<code>Decorator</code>语法就是装饰器模式</li></ul></li></ul>
<blockquote><p>经典设计模式有<code>23</code> 个，这是基于后端写的，前端不是都常用</p></blockquote>
<h3 id="如果一个h5很慢-如何排查性能问题"><a href="#如果一个h5很慢-如何排查性能问题" class="header-anchor">#</a> 如果一个H5很慢，如何排查性能问题</h3>
<ul><li>通过前端性能指标分析</li> <li>通过<code>Performance</code>、<code>lighthouse</code>分析</li> <li>持续跟进，持续优化</li></ul>
<p><strong>前端性能指标</strong></p>
<ul><li><code>FP(First Paint)</code>：首次绘制，即首次绘制任何内容到屏幕上</li> <li><code>FCP(First Content Paint)</code>：首次内容绘制，即首次绘制非空白内容到屏幕上</li> <li><code>FMP(First Meaning Paint)</code>：首次有意义绘制，即首次绘制有意义的内容到屏幕上-已弃用，改用<code>LCP</code> <ul><li><code>FMP</code>业务指标，没有统一标准</li></ul></li> <li><code>LCP(Largest Contentful Paint)</code>：最大内容绘制，即最大的内容绘制到屏幕上</li> <li><code>TTI(Time to Interactive)</code>：可交互时间，即页面加载完成，可以进行交互的时间</li> <li><code>TBT(Total Blocking Time)</code>：总阻塞时间，即页面加载过程中，主线程被占用的时间</li> <li><code>CLS(Cumulative Layout Shift)</code>：累计布局偏移，即页面加载过程中，元素位置发生变化的程度</li> <li><code>FCP</code>、<code>LCP</code>、<code>TTI</code>、<code>TBT</code>、<code>CLS</code>都是<code>web-vitals</code>库提供的指标</li> <li><code>DCL(DOM Content Loaded)</code>：<code>DOM</code>加载完成，即页面<code>DOM</code>结构加载完成的时间</li> <li><code>L(Load)</code>：页面完全加载完成的时间</li></ul>
<p><img alt="" src="https://s.poetries.top/uploads/2022/07/5eb6f5edb37a9abd.png"></p>
<p><strong>通过Chrome Performance分析</strong></p>
<blockquote><p>打开浏览器无痕模式，点击<code>Performance &gt; ScreenShot</code></p></blockquote>
<p><img alt="" src="https://s.poetries.top/uploads/2023/01/182f4ecc5a9438e1.png"></p>
<p>如果加载很快就会很快就到达<code>FP</code>，在分析<code>FCP、LCP、DCL、L</code>看渲染时间</p>
<p><img alt="" src="https://s.poetries.top/uploads/2023/01/01b6b3e2049c7f2b.png"></p>
<p>国内访问GitHub可以看到加载到<code>FP</code>非常慢，但是渲染很快</p>
<p><img alt="" src="https://s.poetries.top/uploads/2023/01/5b5e62734fa8f2cc.png"></p>
<p><code>network &gt; show overview</code> 查看每个资源的加载时间，或者从<code>waterfall</code>查看</p>
<p><img alt="" src="https://s.poetries.top/uploads/2023/01/225e509acef89fbf.png"></p>
<p><strong>使用lighthouse分析</strong></p>
<p><img alt="" src="https://s.poetries.top/uploads/2023/01/48150d9b04f2240f.png"></p>
<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 通过node使用</span>
<span class="token function">npm</span> i lighthouse -g

<span class="token comment"># 需要稍等一会就分析完毕输出报告</span>
lighthouse https://baidu.com --view --preset<span class="token operator">=</span>desktop
</code></pre></div>
<p><strong>通过工具就可以识别到问题</strong></p>
<ul><li>加载慢？
<ul><li>优化服务器硬件配置，使用<code>CDN</code></li> <li>路由懒加载，大组件异步加载--减少主包体积</li> <li>优化<code>HTTP</code>缓存策略</li></ul></li> <li>渲染慢
<ul><li>优化服务端接口（如<code>Ajax</code>获取数据慢）</li> <li>继续分析，优化前端组件内部逻辑（参考<code>vue</code>、<code>react</code>优化）</li> <li>服务端渲染<code>SSR</code></li></ul></li></ul>
<blockquote><p>性能优化是一个循序渐进的过程，不像bug一次解决。持续跟进统计结果，再逐步分析性能瓶颈，持续优化。可使用第三方统计服务，如百度统计</p></blockquote>
<h3 id="后端一次性返回十万条数据-你该如何渲染"><a href="#后端一次性返回十万条数据-你该如何渲染" class="header-anchor">#</a> 后端一次性返回十万条数据，你该如何渲染</h3>
<ul><li><strong>设计不合理</strong> <ul><li>后端返回十万条数据，本身技术方案设计就不合理（一般情况都是分页返回，返回十万条浏览器渲染是一个问题，十万条数据加载也需要一个过程）</li> <li>后端的问题，要用后端的思维去解决-中间层</li></ul></li> <li>浏览器能否处理十万条数据？
<ul><li>渲染到<code>DOM</code>上会非常卡顿</li></ul></li> <li><strong>方案1：自定义中间层</strong> <ul><li>自定义<code>nodejs</code>中间层，获取并拆分这十万条数据</li> <li>前端对接<code>nodejs</code>中间层，而不是服务端</li> <li>成本比较高</li></ul></li> <li><strong>方案2：虚拟列表</strong> <ul><li>只创建可视区的<code>DOM</code>（比如前十条数据），其他区域不显示，根据数据条数计算每条数据的高度，用<code>div</code>撑起高度</li> <li>随着浏览器的滚动，创建和销毁<code>DOM</code></li> <li>虚拟列表实现起来非常复杂，工作中可使用第三方库（<code>vue-virtual-scroll-list</code>、<code>react-virtualiszed</code>）</li> <li>虚拟列表只是无奈的选择，实现复杂效果而效果不一定好（低配手机）</li></ul></li></ul>
<p><img alt="" src="https://s.poetries.top/uploads/2023/01/2f1725384591607d.png"></p>
<h3 id="h5页面如何进行首屏优化"><a href="#h5页面如何进行首屏优化" class="header-anchor">#</a> H5页面如何进行首屏优化</h3>
<ul><li><strong>路由懒加载</strong> <ul><li>适用于单页面应用</li> <li>路由拆分，优先保证首页加载</li></ul></li> <li><strong>服务端渲染SSR</strong> <ul><li><code>SSR</code>渲染页面过程简单，性能好</li> <li>纯<code>H5</code>页面，<code>SSR</code>是性能优化的终极方案，但对服务器成本也高</li></ul></li> <li><strong>分页</strong> <ul><li>针对列表页，默认只展示第一页内容</li> <li>上划加载更多</li></ul></li> <li><strong>图片懒加载lazyLoad</strong> <ul><li>针对详情页，默认只展示文本内容，然后触发图片懒加载</li> <li>注意：提前设置图片尺寸，尽量只重绘不重排</li></ul></li> <li><strong>Hybrid</strong> <ul><li>提前将<code>HTML JS CSS</code>下载到<code>App</code>内部，省去我们从网上下载静态资源的时间</li> <li>在<code>App webview</code>中使用<code>file://</code>协议加载页面文件</li> <li>再用<code>Ajax</code>获取内容并展示</li></ul></li> <li>性能优化要配合分析、统计、评分等，做了事情要有结果有说服力</li> <li>性能优化也要配合体验，如骨架屏、<code>loading</code>动画等</li></ul>
<p><strong>图片懒加载演示</strong></p>
<div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
    <span class="token selector">.item-container</span> <span class="token punctuation">{</span>
      <span class="token property">border-top</span><span class="token punctuation">:</span> 1px solid #ccc<span class="token punctuation">;</span>
      <span class="token property">margin-bottom</span><span class="token punctuation">:</span> 30px<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token selector">.item-container img</span> <span class="token punctuation">{</span>
      <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
      <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #eee<span class="token punctuation">;</span>
      <span class="token property">border-radius</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
      <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>img lazy load<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item-container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>新闻标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./img/loading.gif<span class="token punctuation">"</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./img/animal1.jpeg<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item-container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>新闻标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./img/loading.gif<span class="token punctuation">"</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./img/animal2.webp<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item-container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>新闻标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./img/loading.gif<span class="token punctuation">"</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./img/animal3.jpeg<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item-container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>新闻标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./img/loading.gif<span class="token punctuation">"</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./img/animal4.webp<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item-container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>新闻标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./img/loading.gif<span class="token punctuation">"</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./img/animal5.webp<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item-container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>新闻标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./img/loading.gif<span class="token punctuation">"</span></span> <span class="token attr-name">data-src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>./img/animal6.webp<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.bootcdn.net/ajax/libs/lodash.js/4.17.21/lodash.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
      <span class="token keyword">function</span> <span class="token function">mapImagesAndTryLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> images <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">'img[data-src]'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>images<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span>

        images<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">img</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> rect <span class="token operator">=</span> img<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>rect<span class="token punctuation">.</span>top <span class="token operator">&lt;</span> window<span class="token punctuation">.</span>innerHeight<span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token comment">// 漏出来</span>
              <span class="token comment">// console.info('loading img', img.dataset.src)</span>
              img<span class="token punctuation">.</span>src <span class="token operator">=</span> img<span class="token punctuation">.</span>dataset<span class="token punctuation">.</span>src
              img<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'data-src'</span><span class="token punctuation">)</span> <span class="token comment">// 移除 data-src 属性，为了下次执行时减少计算成本</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>

      window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'scroll'</span><span class="token punctuation">,</span> _<span class="token punctuation">.</span><span class="token function">throttle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">mapImagesAndTryLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

      <span class="token function">mapImagesAndTryLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div>
<h3 id="请描述js-bridge的实现原理"><a href="#请描述js-bridge的实现原理" class="header-anchor">#</a> 请描述js-bridge的实现原理</h3>
<p><strong>什么是JS Bridge</strong></p>
<ul><li><code>JS</code>无法直接调用<code>native API</code></li> <li>需要通过一些特定的格式来调用</li> <li>这些格式就统称<code>js-bridge</code>，例如微信<code>JSSKD</code></li></ul>
<p><img alt="" src="https://s.poetries.top/uploads/2023/01/0e45cf3988121684.png"> <img alt="" src="https://s.poetries.top/uploads/2023/01/e68963dec49dbe97.png"></p>
<p><strong>JS Bridge的常见实现方式</strong></p>
<ul><li>注册全局<code>API</code></li> <li><code>URL Scheme</code>（推荐）</li></ul>
<div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!-- &lt;iframe id="iframe1"&gt;&lt;/iframe&gt; --&gt;</span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// const version = window.getVersion() // 异步</span>

  <span class="token comment">// const iframe1 = document.getElementById('iframe1')</span>
  <span class="token comment">// iframe1.onload = () =&gt; {</span>
  <span class="token comment">//     const content = iframe1.contentWindow.document.body.innerHTML</span>
  <span class="token comment">//     console.info('content', content)</span>
  <span class="token comment">// }</span>
  <span class="token comment">// iframe1.src = 'my-app-name://api/getVersion' // app识别协议my-app-name://，在app内处理返回给webview，而不是直接发送网络请求</span>
  <span class="token comment">// URL scheme</span>

  <span class="token comment">// 使用iframe 封装 JS-bridge</span>
  <span class="token keyword">const</span> sdk <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token parameter">url<span class="token punctuation">,</span> data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> onSuccess<span class="token punctuation">,</span> onError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span>
      iframe<span class="token punctuation">.</span>style<span class="token punctuation">.</span>visibility <span class="token operator">=</span> <span class="token string">'hidden'</span> <span class="token comment">// 隐藏iframe</span>
      document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span>
      iframe<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> content <span class="token operator">=</span> iframe1<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span>document<span class="token punctuation">.</span>body<span class="token punctuation">.</span>innerHTML
        <span class="token function">onSuccess</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span>
        iframe<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      iframe<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">onError</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        iframe<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      iframe<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">my-app-name://</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">?data=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">fn1</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> onSuccess<span class="token punctuation">,</span> onError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'api/fn1'</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> onSuccess<span class="token punctuation">,</span> onError<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">fn2</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> onSuccess<span class="token punctuation">,</span> onError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'api/fn2'</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> onSuccess<span class="token punctuation">,</span> onError<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">fn3</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span> onSuccess<span class="token punctuation">,</span> onError</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token string">'api/fn3'</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> onSuccess<span class="token punctuation">,</span> onError<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div>
<h3 id="从零搭建开发环境需要考虑什么"><a href="#从零搭建开发环境需要考虑什么" class="header-anchor">#</a> 从零搭建开发环境需要考虑什么</h3>
<ul><li>代码仓库，发布到哪个<code>npm</code>仓库（如有需要）</li> <li>技术选型，<code>Vue</code>或<code>React</code></li> <li>代码目录规范</li> <li>打包构建<code>webpack</code>等，做打包优化</li> <li><code>eslint</code>、<code>prettier</code>、<code>commit-lint</code></li> <li><code>pre-commit</code> 提交前检查（在调用<code>git commit</code> 命令时自动执行某些脚本检测代码,若检测出错,则阻止<code>commit</code>代码,也就无法<code>push</code>）</li> <li>单元测试</li> <li><code>CI/CD</code>流程（如搭建<code>jenkins</code>部署项目）</li> <li>开发环境、预发布环境</li> <li>编写开发文档</li></ul>
<h3 id="如果你是项目前端技术负责人-将如何做技术选型-常考"><a href="#如果你是项目前端技术负责人-将如何做技术选型-常考" class="header-anchor">#</a> 如果你是项目前端技术负责人，将如何做技术选型（常考）</h3>
<ul><li><strong>技术选型，选什么？</strong> <ul><li>前端框架（<code>Vue React Nuxt.hs Next.js</code> 或者<code>nodejs</code>框架）</li> <li>语言（<code>JavaScript</code>或<code>Typescript</code>）</li> <li>其他（构建工具、<code>CI/CD</code>等）</li></ul></li> <li><strong>技术选型的依据</strong> <ul><li>社区是否足够成熟</li> <li>公司已经有了经验积累</li> <li>团队成员的学习成本</li> <li>要站在公司角度，而非个人角度</li></ul></li> <li><strong>要全面考虑各种成本</strong> <ul><li>学习成本</li> <li>管理成本（如用<code>TS</code>遍地都是<code>any</code>怎么办）</li> <li>运维成本（如用<code>ssr</code>技术）</li></ul></li></ul>
<h3 id="高效的字符串前缀匹配如何做"><a href="#高效的字符串前缀匹配如何做" class="header-anchor">#</a> 高效的字符串前缀匹配如何做</h3>
<ul><li>有一个英文单词库（数组），里面有几十个英文单词</li> <li>输入一个字符串，快速判断是不是某一个单词的前缀</li> <li>说明思路，不用写代码</li></ul>
<p><strong>思路分析</strong></p>
<ul><li>常规思路
<ul><li>遍历单词库数组</li> <li><code>indexOf</code>判断前缀</li> <li>实际复杂度超过了<code>O(n)</code>，因为每一步遍历要考虑<code>indexOf</code>的计算量</li></ul></li> <li>优化
<ul><li>英文字母一共<code>26</code>个，可以提前把单词库数组拆分为<code>26</code>个</li> <li>第一层拆分为<code>26</code>个，第二第三层也可以继续拆分</li> <li>最后把单词库拆分为一颗树</li> <li>如<code>array</code>拆分为<code>{a:{r:{r:{a:{y:{}}}}}}</code> 查询的时候这样查<code>obj.a.r.r.a.y</code> 时间复杂度就是<code>O(1)</code></li> <li>转为为树的过程我们不用管，单词库更新频率一般都是很低的，我们执行一次提前转换好，通过哈希表（对象）查询<code>key</code>非常快</li></ul></li> <li>性能分析
<ul><li>如遍历数组，时间复杂度至少<code>O(n)</code>起步（<code>n</code>是数组长度）</li> <li>改为树，时间复杂度从大于<code>O(n)</code>降低到<code>O(m)</code>（<code>m</code>是单词的长度）</li> <li>哈希表（对象）通过<code>key</code>查询，时间复杂度是<code>O(1)</code></li></ul></li></ul>
<h3 id="前端路由原理"><a href="#前端路由原理" class="header-anchor">#</a> 前端路由原理</h3>
<p><strong>hash的特点</strong></p>
<ul><li><code>hash</code>变化会触发网页跳转，即浏览器的前进和后退</li> <li><code>hash</code>变化不会刷新页面，<code>SPA</code>必须的特点</li> <li><code>hash</code>永远不会提交到<code>server</code>端</li> <li>通过<code>onhashchange</code>监听</li></ul>
<p><strong>H5 History</strong></p>
<ul><li>用<code>url</code>规范的路由，但跳转时不刷新页面</li> <li>通过<code>history.pushState</code>和<code>history.onpopstate</code>监听</li> <li><code>H5 History</code>需要后端支持
<ul><li>当我们进入到子路由时刷新页面，<code>web</code>容器没有相对应的页面此时会出现<code>404</code></li> <li>所以我们只需要配置将任意页面都重定向到 <code>index.html</code>，把路由交由前端处理</li> <li>对<code>nginx</code>配置文件<code>.conf</code>修改，添加<code>try_files $uri $uri/ /index.html;</code></li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code><span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
  <span class="token directive"><span class="token keyword">listen</span>  <span class="token number">80</span></span><span class="token punctuation">;</span>
  <span class="token directive"><span class="token keyword">server_name</span>  www.xxx.com</span><span class="token punctuation">;</span>

  <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">index</span>  /data/dist/index.html</span><span class="token punctuation">;</span>
    <span class="token directive"><span class="token keyword">try_files</span> <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ /index.html</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul>
<p><strong>两者选择</strong></p>
<ul><li><code>to B</code>系统推荐使用hash，简单易用，对<code>url</code>规范不敏感</li> <li><code>to C</code>系统，可以考虑使用<code>H5 History</code>，但需要服务端支持</li> <li>能选择简单的，就别用复杂的，要考虑成本和收益</li></ul>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// hash 变化，包括：</span>
<span class="token comment">// a. JS 修改 url</span>
<span class="token comment">// b. 手动修改 url 的 hash</span>
<span class="token comment">// c. 浏览器前进、后退</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onhashchange</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'old url'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>oldURL<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'new url'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>newURL<span class="token punctuation">)</span>

    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hash:'</span><span class="token punctuation">,</span> location<span class="token punctuation">.</span>hash<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 页面初次加载，获取 hash</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hash:'</span><span class="token punctuation">,</span> location<span class="token punctuation">.</span>hash<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// JS 修改 url</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">'#/user'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// history API</span>

<span class="token comment">// 页面初次加载，获取 path</span>
document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span> location<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 打开一个新的路由</span>
<span class="token comment">// 【注意】用 pushState 方式，浏览器不会刷新页面</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'btn1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'page1'</span> <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'切换路由到'</span><span class="token punctuation">,</span> <span class="token string">'page1'</span><span class="token punctuation">)</span>
    history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'page1'</span><span class="token punctuation">)</span> <span class="token comment">// 重要！！</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 监听浏览器前进、后退</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onpopstate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">// 重要！！</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'onpopstate'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>state<span class="token punctuation">,</span> location<span class="token punctuation">.</span>pathname<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 需要 server 端配合，可参考</span>
<span class="token comment">// https://router.vuejs.org/zh/guide/essentials/history-mode.html#%E5%90%8E%E7%AB%AF%E9%85%8D%E7%BD%AE%E4%BE%8B%E5%AD%90</span>
</code></pre></div>
<h3 id="首屏渲染优化"><a href="#首屏渲染优化" class="header-anchor">#</a> 首屏渲染优化</h3>
<ul><li><code>css</code> / <code>js</code> 分割，使首屏依赖的文件体积最小，内联首屏关键 <code>css</code> / <code>js</code>；</li> <li>非关键性的文件尽可能的 异步加载和懒加载，避免阻塞首页渲染；</li> <li>使用<code>dns-prefetch</code> / <code>preconnect</code> / <code>prefetch</code> / preload等浏览器提供的资源提示，加快文件传输；</li> <li>谨慎控制好 Web字体，一个大字体包足够让你功亏一篑
<ul><li>控制字体包的加载时机；</li> <li>如果使用的字体有限，那尽可能只将使用的文字单独打包，能有效减少体积；
合理利用 <code>Localstorage</code> / <code>services worker</code> 等存储方式进行 数据与资源缓存</li></ul></li> <li><strong>分清轻重缓急</strong> <ul><li>重要的元素优先渲染；</li> <li>视窗内的元素优先渲染</li></ul></li> <li><strong>服务端渲染(SSR)</strong>:
<ul><li>减少首屏需要的数据量，剔除冗余数据和请求；</li> <li>控制好缓存，对数据/页面进行合理的缓存；</li> <li>页面的请求使用流的形式进行传递；</li></ul></li> <li><strong>优化用户感知</strong> <ul><li>利用一些动画 过渡效果，能有效减少用户对卡顿的感知；</li> <li>尽可能利用 骨架屏(<code>Placeholder</code>) / <code>Loading</code> 等减少用户对白屏的感知；</li> <li>动画帧数尽量保证在 <code>30帧</code> 以上，低帧数、卡顿的动画宁愿不要；</li> <li>js 执行时间避免超过 <code>100ms</code>，超过的话就需要做
<ul><li>寻找可 缓存 的点</li> <li>任务的 分割异步 或 <code>web worker</code> 执行</li></ul></li></ul></li></ul>
<p><strong>移动端的性能优化</strong></p>
<ol><li>首屏加载和按需加载，懒加载</li> <li>资源预加载</li> <li>图片压缩处理，使用<code>base64</code>内嵌图片</li> <li>合理缓存<code>dom</code>对象</li> <li>使用<code>touchstart</code>代替<code>click</code>（<code>click 300</code>毫秒的延迟）</li> <li>利用<code>transform:translateZ(0)</code>，开启硬件GUP加速</li> <li>不滥用<code>web</code>字体，不滥用<code>float</code>（布局计算消耗性能），减少<code>font-size</code>声明</li> <li>使用<code>viewport</code>固定屏幕渲染，加速页面渲染内容</li> <li>尽量使用事件代理，避免直接事件绑定</li></ol>
<h3 id="interface和type的区别-常考"><a href="#interface和type的区别-常考" class="header-anchor">#</a> interface和type的区别（常考）</h3>
<p>在TypeScript中，<code>interface</code>和<code>type</code>都用于定义类型，但它们有一些区别：</p>
<ol><li>语法差异：</li></ol>
<ul><li><code>interface</code>：使用<code>interface</code>关键字来定义接口，例如：<code>interface Person { name: string; age: number; }</code></li> <li><code>type</code>：使用<code>type</code>关键字来定义类型别名，例如：<code>type Person = { name: string; age: number; }</code></li></ul>
<ol start="2"><li>可扩展性：</li></ol>
<ul><li><code>interface</code>：接口可以通过继承或合并来扩展，可以在定义接口时使用<code>extends</code>关键字继承其他接口，也可以使用<code>&amp;</code>运算符合并多个接口。</li> <li><code>type</code>：类型别名不支持继承或合并，它只能用于定义现有类型的别名。</li></ul>
<ol start="3"><li>表达能力：</li></ol>
<ul><li><code>interface</code>：接口可以描述对象、函数、类等复杂类型，还可以定义可选属性、只读属性、函数类型等。</li> <li><code>type</code>：类型别名可以描述对象、联合类型、交叉类型等，但不支持定义类和接口。</li></ul>
<ol start="4"><li>使用场景：</li></ol>
<ul><li><code>interface</code>：适用于定义对象的形状和结构，以及类的实现。</li> <li><code>type</code>：适用于定义复杂类型别名、联合类型、交叉类型等。</li></ul>
<p>总的来说，<code>interface</code>更适合用于定义对象的形状和结构，而<code>type</code>更适合用于定义复杂类型别名和联合类型。在实际使用中，可以根据具体需求选择使用哪种方式。</p>
</div>