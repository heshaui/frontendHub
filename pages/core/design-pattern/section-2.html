<!-- Section: # 二、创建型模式 -->
<div class="section-content" data-section-id="二、创建型模式">
<h2 id="二、创建型模式"><a href="#二、创建型模式" class="header-anchor">#</a> 二、创建型模式</h2>
<h3 id="单例模式"><a href="#单例模式" class="header-anchor">#</a> 单例模式</h3>
<ul><li>单例模式可能是设计模式里面最简单的模式了，虽然简单，但在我们日常生活和编程中却经常接触到，本节我们一起来学习一下。</li> <li>单例模式 （Singleton Pattern）又称为单体模式，保证一个类只有一个实例，并提供一个访问它的全局访问点。也就是说，第二次使用同一个类创建新对象的时候，应该得到与第一次创建的对象完全相同的对象。</li></ul>
<p><strong>1. 你曾经遇见过的单例模式</strong></p>
<ul><li>当我们在电脑上玩经营类的游戏，经过一番眼花缭乱的骚操作好不容易走上正轨，夜深了我们去休息，第二天打开电脑，发现要从头玩，立马就把电脑扔窗外了，所以一般希望从前一天的进度接着打，这里就用到了存档。每次玩这游戏的时候，我们都希望拿到同一个存档接着玩，这就是属于单例模式的一个实例。</li> <li>编程中也有很多对象我们只需要唯一一个，比如数据库连接、线程池、配置文件缓存、浏览器中的 window/document 等，如果创建多个实例，会带来资源耗费严重，或访问行为不一致等情况。</li> <li>类似于数据库连接实例，我们可能频繁使用，但是创建它所需要的开销又比较大，这时只使用一个数据库连接就可以节约很多开销。一些文件的读取场景也类似，如果文件比较大，那么文件读取就是一个比较重的操作。比如这个文件是一个配置文件，那么完全可以将读取到的文件内容缓存一份，每次来读取的时候访问缓存即可，这样也可以达到节约开销的目的。</li></ul>
<p><strong>在类似场景中，这些例子有以下特点：</strong></p>
<ul><li>每次访问者来访问，返回的都是同一个实例；</li> <li>如果一开始实例没有创建，那么这个特定类需要自行创建这个实例；</li></ul>
<p><strong>2. 实例的代码实现</strong></p>
<ul><li>如果你是一个前端er，那么你肯定知道浏览器中的 <code>window</code> 和 <code>document</code> 全局变量，这两个对象都是单例，任何时候访问他们都是一样的对象，<code>window</code> 表示包含 <code>DOM</code> 文档的窗口，<code>document</code> 是窗口中载入的 <code>DOM</code> 文档，分别提供了各自相关的方法。</li> <li>在 ES6 新增语法的 <code>Module</code> 模块特性，通过 <code>import/export</code> 导出模块中的变量是单例的，也就是说，如果在某个地方改变了模块内部变量的值，别的地方再引用的这个值是改变之后的。除此之外，项目中的全局状态管理模式 Vuex、Redux、MobX 等维护的全局状态，<code>vue-router</code>、<code>react-router</code> 等维护的路由实例，在单页应用的单页面中都属于单例的应用（但不属于单例模式的应用）。</li> <li>在 JavaScript 中使用字面量方式创建一个新对象时，实际上没有其他对象与其类似，因为新对象已经是单例了：</li></ul>
<div class="language- extra-class"><pre class="language-text"><code>{ a: 1 } === { a: 1 } 		// false
</code></pre></div>
<ul><li>那么问题来了，如何对构造函数使用 new 操作符创建多个对象时，仅获取同一个单例对象呢。</li> <li>对于刚刚打经营游戏的例子，我们可以用 JavaScript 来实现一下：</li></ul>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">ManageGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ManageGame<span class="token punctuation">.</span>_schedule<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 判断是否已经有单例了</span>
        <span class="token keyword">return</span> ManageGame<span class="token punctuation">.</span>_schedule
    <span class="token punctuation">}</span>
    ManageGame<span class="token punctuation">.</span>_schedule <span class="token operator">=</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span>

ManageGame<span class="token punctuation">.</span><span class="token function-variable function">getInstance</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ManageGame<span class="token punctuation">.</span>_schedule<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 判断是否已经有单例了</span>
        <span class="token keyword">return</span> ManageGame<span class="token punctuation">.</span>_schedule
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ManageGame<span class="token punctuation">.</span>_schedule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ManageGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> schedule1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ManageGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> schedule2 <span class="token operator">=</span> ManageGame<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>schedule1 <span class="token operator">===</span> schedule2<span class="token punctuation">)</span>
</code></pre></div>
<blockquote><p>稍微解释一下，这个构造函数在内部维护（或者直接挂载自己身上）一个实例，第一次执行 new 的时候判断这个实例有没有创建过，创建过就直接返回，否则走创建流程。我们可以用 <code>ES6</code> 的 <code>class</code> 语法改造一下：</p></blockquote>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ManageGame</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> _schedule <span class="token operator">=</span> <span class="token keyword">null</span>
    
    <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ManageGame<span class="token punctuation">.</span>_schedule<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 判断是否已经有单例了</span>
            <span class="token keyword">return</span> ManageGame<span class="token punctuation">.</span>_schedule
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> ManageGame<span class="token punctuation">.</span>_schedule <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ManageGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ManageGame<span class="token punctuation">.</span>_schedule<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment">// 判断是否已经有单例了</span>
            <span class="token keyword">return</span> ManageGame<span class="token punctuation">.</span>_schedule
        <span class="token punctuation">}</span>
        ManageGame<span class="token punctuation">.</span>_schedule <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> schedule1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ManageGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> schedule2 <span class="token operator">=</span> ManageGame<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>schedule1 <span class="token operator">===</span> schedule2<span class="token punctuation">)</span>	<span class="token comment">// true</span>
</code></pre></div>
<p>上面方法的缺点在于维护的实例作为静态属性直接暴露，外部可以直接修改。</p>
<p><strong>3. 单例模式的通用实现</strong></p>
<blockquote><p>根据上面的例子提炼一下单例模式，游戏可以被认为是一个特定的类（Singleton），而存档是单例（instance），每次访问特定类的时候，都会拿到同一个实例。主要有下面几个概念：</p></blockquote>
<ul><li><code>Singleton</code> ：特定类，这是我们需要访问的类，访问者要拿到的是它的实例；</li> <li><code>instance</code> ：单例，是特定类的实例，特定类一般会提供 getInstance 方法来获取该单例；</li> <li><code>getInstance</code> ：获取单例的方法，或者直接由 new 操作符获取；</li></ul>
<p><strong>这里有几个实现点要关注一下：</strong></p>
<ul><li>访问时始终返回的是同一个实例；</li> <li>自行实例化，无论是一开始加载的时候就创建好，还是在第一次被访问时；</li> <li>一般还会提供一个 getInstance 方法用来获取它的实例；</li></ul>
<p>结构大概如下图：</p>
<p><img alt="" src="https://s.poetries.top/gitee/2020/07/82.png"></p>
<p>下面使用通用的方法来实现一下。</p>
<p><strong>3.1 IIFE 方式创建单例模式</strong></p>
<ul><li>简单实现中，我们提到了缺点是实例会暴露，那么这里我们首先使用立即调用函数 IIFE 将不希望公开的单例实例 instance 隐藏。</li> <li>当然也可以使用构造函数复写将闭包进行的更彻底，具体代码参看 Github 仓库，这里就不贴了。</li></ul>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Singleton <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _instance <span class="token operator">=</span> <span class="token keyword">null</span>        <span class="token comment">// 存储单例</span>
    
    <span class="token keyword">const</span> <span class="token function-variable function">Singleton</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_instance<span class="token punctuation">)</span> <span class="token keyword">return</span> _instance     <span class="token comment">// 判断是否已有单例</span>
        _instance <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                         <span class="token comment">// 初始化操作</span>
        <span class="token keyword">return</span> _instance
    <span class="token punctuation">}</span>
    
    <span class="token class-name">Singleton</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">'Singleton Pattern'</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> Singleton
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> visitor1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> visitor2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>visitor1 <span class="token operator">===</span> visitor2<span class="token punctuation">)</span>	<span class="token comment">// true</span>
</code></pre></div>
<ul><li>这样一来，虽然仍使用一个变量 <code>_instance</code> 来保存单例，但是由于在闭包的内部，所以外部代码无法直接修改。</li> <li>在这个基础上，我们可以继续改进，增加 <code>getInstance</code> 静态方法：</li></ul>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Singleton <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _instance <span class="token operator">=</span> <span class="token keyword">null</span>        <span class="token comment">// 存储单例</span>
    
    <span class="token keyword">const</span> <span class="token function-variable function">Singleton</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_instance<span class="token punctuation">)</span> <span class="token keyword">return</span> _instance     <span class="token comment">// 判断是否已有单例</span>
        _instance <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                         <span class="token comment">// 初始化操作</span>
        <span class="token keyword">return</span> _instance
    <span class="token punctuation">}</span>
    
    <span class="token class-name">Singleton</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">'Singleton Pattern'</span>
    <span class="token punctuation">}</span>
    
    Singleton<span class="token punctuation">.</span><span class="token function-variable function">getInstance</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_instance<span class="token punctuation">)</span> <span class="token keyword">return</span> _instance
        _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> _instance
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> Singleton
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> visitor1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> visitor2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token comment">// 既可以 new 获取单例</span>
<span class="token keyword">const</span> visitor3 <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 也可以 getInstance 获取单例</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>visitor1 <span class="token operator">===</span> visitor2<span class="token punctuation">)</span>	<span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>visitor1 <span class="token operator">===</span> visitor3<span class="token punctuation">)</span>	<span class="token comment">// true</span>
</code></pre></div>
<ul><li>代价和上例一样是闭包开销，并且因为 IIFE 操作带来了额外的复杂度，让可读性变差。</li> <li>IIFE 内部返回的 Singleton 才是我们真正需要的单例的构造函数，外部的 Singleton 把它和一些单例模式的创建逻辑进行了一些封装。</li> <li>IIFE 方式除了直接返回一个方法/类实例之外，还可以通过模块模式的方式来进行，就不贴代码了，代码实现在 Github 仓库中，读者可以自己瞅瞅。</li></ul>
<p><strong>3.2 块级作用域方式创建单例</strong></p>
<blockquote><p>IIFE 方式本质还是通过函数作用域的方式来隐藏内部作用域的变量，有了 ES6 的 <code>let/const</code> 之后，可以通过 <code>{ }</code> 块级作用域的方式来隐藏内部变量：</p></blockquote>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> getInstance

<span class="token punctuation">{</span>
    <span class="token keyword">let</span> _instance <span class="token operator">=</span> <span class="token keyword">null</span>        <span class="token comment">// 存储单例</span>
    
    <span class="token keyword">const</span> <span class="token function-variable function">Singleton</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_instance<span class="token punctuation">)</span> <span class="token keyword">return</span> _instance     <span class="token comment">// 判断是否已有单例</span>
        _instance <span class="token operator">=</span> <span class="token keyword">this</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                         <span class="token comment">// 初始化操作</span>
        <span class="token keyword">return</span> _instance
    <span class="token punctuation">}</span>
    
    <span class="token class-name">Singleton</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">init</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">'Singleton Pattern'</span>
    <span class="token punctuation">}</span>
    
    <span class="token function-variable function">getInstance</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_instance<span class="token punctuation">)</span> <span class="token keyword">return</span> _instance
        _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> _instance
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> visitor1 <span class="token operator">=</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> visitor2 <span class="token operator">=</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>visitor1 <span class="token operator">===</span> visitor2<span class="token punctuation">)</span>
</code></pre></div>
<p>输出: <code>true</code>
怎么样，是不是对块级作用域的理解更深了呢～</p>
<p><strong>3.3 单例模式赋能</strong></p>
<blockquote><p>之前的例子中，单例模式的创建逻辑和原先这个类的一些功能逻辑（比如 <code>init</code> 等操作）混杂在一起，根据单一职责原则，这个例子我们还可以继续改进一下，将单例模式的创建逻辑和特定类的功能逻辑拆开，这样功能逻辑就可以和正常的类一样。</p></blockquote>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* 功能类 */</span>
<span class="token keyword">class</span> <span class="token class-name">FuncClass</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">bar</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> bar
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">'Singleton Pattern'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 单例模式的赋能类 */</span>
<span class="token keyword">const</span> Singleton <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _instance <span class="token operator">=</span> <span class="token keyword">null</span>        <span class="token comment">// 存储单例</span>
    
    <span class="token keyword">const</span> <span class="token function-variable function">ProxySingleton</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bar</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_instance<span class="token punctuation">)</span> <span class="token keyword">return</span> _instance     <span class="token comment">// 判断是否已有单例</span>
        _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FuncClass</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span>
        <span class="token keyword">return</span> _instance
    <span class="token punctuation">}</span>
    
    ProxySingleton<span class="token punctuation">.</span><span class="token function-variable function">getInstance</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">bar</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_instance<span class="token punctuation">)</span> <span class="token keyword">return</span> _instance
        _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span>
        <span class="token keyword">return</span> _instance
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> ProxySingleton
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> visitor1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token string">'单例1'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> visitor2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Singleton</span><span class="token punctuation">(</span><span class="token string">'单例2'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> visitor3 <span class="token operator">=</span> Singleton<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>visitor1 <span class="token operator">===</span> visitor2<span class="token punctuation">)</span>	<span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>visitor1 <span class="token operator">===</span> visitor3<span class="token punctuation">)</span>	<span class="token comment">// true</span>
</code></pre></div>
<ul><li>这样的单例模式赋能类也可被称为代理类，将业务类和单例模式的逻辑解耦，把单例的创建逻辑抽象封装出来，有利于业务类的扩展和维护。代理的概念我们将在后面代理模式的章节中更加详细地探讨。</li> <li>使用类似的概念，配合 <code>ES6</code> 引入的 <code>Proxy</code> 来拦截默认的 <code>new</code> 方式，我们可以写出更简化的单例模式赋能方法：</li></ul>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* Person 类 */</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
        <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 单例模式的赋能方法 */</span>
<span class="token keyword">function</span> <span class="token function">Singleton</span><span class="token punctuation">(</span><span class="token parameter">FuncClass</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _instance
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>FuncClass<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token function">construct</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> _instance <span class="token operator">||</span> <span class="token punctuation">(</span>_instance <span class="token operator">=</span> Reflect<span class="token punctuation">.</span><span class="token function">construct</span><span class="token punctuation">(</span>FuncClass<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 使用 new FuncClass(...args) 也可以</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> PersonInstance <span class="token operator">=</span> <span class="token function">Singleton</span><span class="token punctuation">(</span>Person<span class="token punctuation">)</span>

<span class="token keyword">const</span> person1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PersonInstance</span><span class="token punctuation">(</span><span class="token string">'张小帅'</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> person2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PersonInstance</span><span class="token punctuation">(</span><span class="token string">'李小美'</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>person1 <span class="token operator">===</span> person2<span class="token punctuation">)</span>	<span class="token comment">// true</span>
</code></pre></div>
<p><strong>4. 惰性单例、懒汉式-饿汉式</strong></p>
<ul><li>有时候一个实例化过程比较耗费性能的类，但是却一直用不到，如果一开始就对这个类进行实例化就显得有些浪费，那么这时我们就可以使用惰性创建，即延迟创建该类的单例。之前的例子都属于惰性单例，实例的创建都是 <code>new</code> 的时候才进行。</li></ul>
<p><strong>惰性单例又被成为懒汉式，相对应的概念是饿汉式：</strong></p>
<ul><li>懒汉式单例是在使用时才实例化</li> <li>饿汉式是当程序启动时或单例模式类一加载的时候就被创建。</li> <li>我们可以举一个简单的例子比较一下：</li></ul>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">FuncClass</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bar <span class="token operator">=</span> <span class="token string">'bar'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 饿汉式</span>
<span class="token keyword">const</span> HungrySingleton <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> _instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FuncClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _instance
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 懒汉式</span>
<span class="token keyword">const</span> LazySingleton <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _instance <span class="token operator">=</span> <span class="token keyword">null</span>
    
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> _instance <span class="token operator">||</span> <span class="token punctuation">(</span>_instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FuncClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> visitor1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HungrySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> visitor2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HungrySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> visitor3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> visitor4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>visitor1 <span class="token operator">===</span> visitor2<span class="token punctuation">)</span>	<span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>visitor3 <span class="token operator">===</span> visitor4<span class="token punctuation">)</span>	<span class="token comment">// true</span>
</code></pre></div>
<blockquote><p>可以打上 <code>debugger</code> 在控制台中看一下，饿汉式在 HungrySingleton 这个 IIFE 执行的时候就进入到 FuncClass 的实例化流程了，而懒汉式的 LazySingleton 中 FuncClass 的实例化过程是在第一次 new 的时候才进行的。</p></blockquote>
<p>惰性创建在实际开发中使用很普遍，了解一下对以后的开发工作很有帮助。</p>
<p><strong>5. 源码中的单例模式</strong></p>
<blockquote><p>以 <code>ElementUI</code> 为例，<code>ElementUI</code> 中的全屏 <code>Loading</code> 蒙层调用有两种形式：</p></blockquote>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 1. 指令形式</span>
Vue<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>Loading<span class="token punctuation">.</span>directive<span class="token punctuation">)</span>
<span class="token comment">// 2. 服务形式</span>
<span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$loading <span class="token operator">=</span> service
</code></pre></div>
<ul><li>上面的是指令形式注册，使用的方式 <code>&lt;div :v-loading.fullscreen="true"&gt;...&lt;/div&gt;</code>；</li> <li>下面的是服务形式注册，使用的方式 <code>this.$loading({ fullscreen: true })</code>；</li></ul>
<blockquote><p>用服务方式使用全屏 <code>Loading</code> 是单例的，即在前一个全屏 <code>Loading</code> 关闭前再次调用全屏 <code>Loading</code>，并不会创建一个新的 <code>Loading</code> 实例，而是返回现有全屏 <code>Loading</code> 的实例。</p></blockquote>
<p>下面我们可以看看 <code>ElementUI 2.9.2</code> 的源码是如何实现的，为了观看方便，省略了部分代码：</p>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> loadingVue <span class="token keyword">from</span> <span class="token string">'./loading.vue'</span>

<span class="token keyword">const</span> LoadingConstructor <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>loadingVue<span class="token punctuation">)</span>

<span class="token keyword">let</span> fullscreenLoading

<span class="token keyword">const</span> <span class="token function-variable function">Loading</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>fullscreen <span class="token operator">&amp;&amp;</span> fullscreenLoading<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> fullscreenLoading
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoadingConstructor</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">el</span><span class="token operator">:</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> options
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>options<span class="token punctuation">.</span>fullscreen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        fullscreenLoading <span class="token operator">=</span> instance
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> instance
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> Loading
</code></pre></div>
<ul><li>这里的单例是 <code>fullscreenLoading</code>，是存放在闭包中的，如果用户传的 <code>options</code> 的 <code>fullscreen</code> 为 <code>true</code> 且已经创建了单例的情况下则回直接返回之前创建的单例，如果之前没有创建过，则创建单例并赋值给闭包中的 <code>fullscreenLoading</code> 后返回新创建的单例实例。</li> <li>这是一个典型的单例模式的应用，通过复用之前创建的全屏蒙层单例，不仅减少了实例化过程，而且避免了蒙层叠加蒙层出现的底色变深的情况。</li></ul>
<p><strong>6. 单例模式的优缺点</strong></p>
<p>单例模式主要解决的问题就是节约资源，保持访问一致性。</p>
<p><strong>简单分析一下它的优点：</strong></p>
<ul><li>单例模式在创建后在内存中只存在一个实例，节约了内存开支和实例化时的性能开支，特别是需要重复使用一个创建开销比较大的类时，比起实例不断地销毁和重新实例化，单例能节约更多资源，比如数据库连接；</li> <li>单例模式可以解决对资源的多重占用，比如写文件操作时，因为只有一个实例，可以避免对一个文件进行同时操作；</li> <li>只使用一个实例，也可以减小垃圾回收机制 GC（Garbage Collecation） 的压力，表现在浏览器中就是系统卡顿减少，操作更流畅，CPU 资源占用更少；</li></ul>
<p><strong>单例模式也是有缺点的</strong></p>
<ul><li>单例模式对扩展不友好，一般不容易扩展，因为单例模式一般自行实例化，没有接口；</li> <li>与单一职责原则冲突，一个类应该只关心内部逻辑，而不关心外面怎么样来实例化；</li></ul>
<p><strong>. 单例模式的使用场景</strong></p>
<p>那我们应该在什么场景下使用单例模式呢：</p>
<ul><li>当一个类的实例化过程消耗的资源过多，可以使用单例模式来避免性能浪费；</li> <li>当项目中需要一个公共的状态，那么需要使用单例模式来保证访问一致性；</li></ul>
<h3 id="工厂模式"><a href="#工厂模式" class="header-anchor">#</a> 工厂模式</h3>
<blockquote><p>工厂模式 （Factory Pattern），根据不同的输入返回不同类的实例，一般用来创建同一类对象。工厂方式的主要思想是将对象的创建与对象的实现分离。</p></blockquote>
<p><strong>1. 你曾见过的工厂模式</strong></p>
<blockquote><p>今天你的老同学找你来玩，你决定下个馆子（因为不会做饭），于是你来到了小区门口的饭店，跟老板说，来一份鱼香肉丝，一份宫保鸡丁。等会儿菜就烧好端到你的面前，不用管菜烧出来的过程，你只要负责吃就行了。</p></blockquote>
<p>上面这两个例子都是工厂模式的实例，老板相当于工厂，负责生产产品，访问者通过老板就可以拿到想要的产品。</p>
<p>在类似场景中，这些例子有以下特点：</p>
<ul><li>访问者只需要知道产品名，就可以从工厂获得对应实例；</li> <li>访问者不关心实例创建过程；</li></ul>
<p><strong>2. 实例的代码实现</strong></p>
<blockquote><p>如果你使用过 <code>document.createElement</code> 方法创建过 <code>DOM</code> 元素，那么你已经使用过工厂方法了，虽然这个方法实际上很复杂，但其使用的就是工厂方法的思想：访问者只需提供标签名（如 <code>div</code>、<code>img</code>），那么这个方法就会返回对应的 DOM 元素。</p></blockquote>
<p>我们可以使用 JavaScript 将上面饭馆例子实现一下：</p>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* 饭店方法 */</span>
<span class="token keyword">function</span> <span class="token function">restaurant</span><span class="token punctuation">(</span><span class="token parameter">menu</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>menu<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'鱼香肉丝'</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">YuXiangRouSi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token string">'宫保鸡丁'</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GongBaoJiDin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'这个菜本店没有 -。-'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 鱼香肉丝类 */</span>
<span class="token keyword">function</span> <span class="token function">YuXiangRouSi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'鱼香肉丝'</span> <span class="token punctuation">}</span>

<span class="token class-name">YuXiangRouSi</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">eat</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' 真香~'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 宫保鸡丁类 */</span>
<span class="token keyword">function</span> <span class="token function">GongBaoJiDin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'宫保鸡丁'</span> <span class="token punctuation">}</span>

<span class="token class-name">GongBaoJiDin</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">eat</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' 让我想起了外婆做的菜~'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> dish1 <span class="token operator">=</span> <span class="token function">restaurant</span><span class="token punctuation">(</span><span class="token string">'鱼香肉丝'</span><span class="token punctuation">)</span>
dish1<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>													<span class="token comment">// 输出: 鱼香肉丝 真香~</span>
<span class="token keyword">const</span> dish2 <span class="token operator">=</span> <span class="token function">restaurant</span><span class="token punctuation">(</span><span class="token string">'红烧排骨'</span><span class="token punctuation">)</span> <span class="token comment">// 输出: Error 这个菜本店没有 -。-</span>
</code></pre></div>
<blockquote><p>工厂方法中这里使用 <code>switch-case</code> 语法，你也可以用 <code>if-else</code>，都可以。</p></blockquote>
<p>下面使用 ES6 的 class 语法改写一下：</p>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* 饭店方法 */</span>
<span class="token keyword">class</span> <span class="token class-name">Restaurant</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token function">getMenu</span><span class="token punctuation">(</span><span class="token parameter">menu</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>menu<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">'鱼香肉丝'</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">YuXiangRouSi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">case</span> <span class="token string">'宫保鸡丁'</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GongBaoJiDin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'这个菜本店没有 -。-'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 鱼香肉丝类 */</span>
<span class="token keyword">class</span> <span class="token class-name">YuXiangRouSi</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'鱼香肉丝'</span> <span class="token punctuation">}</span>
    
    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' 真香~'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 宫保鸡丁类 */</span>
<span class="token keyword">class</span> <span class="token class-name">GongBaoJiDin</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'宫保鸡丁'</span> <span class="token punctuation">}</span>
    
    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' 让我想起了外婆做的菜~'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> dish1 <span class="token operator">=</span> Restaurant<span class="token punctuation">.</span><span class="token function">getMenu</span><span class="token punctuation">(</span><span class="token string">'鱼香肉丝'</span><span class="token punctuation">)</span>
dish1<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>													 				 <span class="token comment">// 输出: 鱼香肉丝 真香~</span>
<span class="token keyword">const</span> dish2 <span class="token operator">=</span> Restaurant<span class="token punctuation">.</span><span class="token function">getMenu</span><span class="token punctuation">(</span><span class="token string">'红烧排骨'</span><span class="token punctuation">)</span>	<span class="token comment">// 输出: Error 这个菜本店没有 -。-</span>
</code></pre></div>
<ul><li>这样就完成了一个工厂模式，但是这个实现有一个问题：工厂方法中包含了很多与创建产品相关的过程，如果产品种类很多的话，这个工厂方法中就会罗列很多产品的创建逻辑，每次新增或删除产品种类，不仅要增加产品类，还需要对应修改在工厂方法，违反了开闭原则，也导致这个工厂方法变得臃肿、高耦合。</li> <li>严格上这种实现在面向对象语言中叫做简单工厂模式。适用于产品种类比较少，创建逻辑不复杂的时候使用。</li> <li>工厂模式的本意是将实际创建对象的过程推迟到子类中，一般用抽象类来作为父类，创建过程由抽象类的子类来具体实现。JavaScript 中没有抽象类，所以我们可以简单地将工厂模式看做是一个实例化对象的工厂类即可。关于抽象类的有关内容，可以参看抽象工厂模式。</li> <li>然而作为灵活的 JavaScript，我们不必如此较真，可以把易变的参数提取出来：</li></ul>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* 饭店方法 */</span>
<span class="token keyword">class</span> <span class="token class-name">Restaurant</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>menuData <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 创建菜品 */</span>
    <span class="token function">getMenu</span><span class="token punctuation">(</span><span class="token parameter">menu</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>menuData<span class="token punctuation">[</span>menu<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'这个菜本店没有 -。-'</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> message <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>menuData<span class="token punctuation">[</span>menu<span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Menu</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> message<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 增加菜品种类 */</span>
    <span class="token function">addMenu</span><span class="token punctuation">(</span><span class="token parameter">menu<span class="token punctuation">,</span> type<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>menuData<span class="token punctuation">[</span>menu<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">Info</span><span class="token punctuation">(</span><span class="token string">'已经有这个菜了!'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>menuData<span class="token punctuation">[</span>menu<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> type<span class="token punctuation">,</span> message <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 移除菜品 */</span>
    <span class="token function">removeMenu</span><span class="token punctuation">(</span><span class="token parameter">menu</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>menuData<span class="token punctuation">[</span>menu<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span>
        <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>menuData<span class="token punctuation">[</span>menu<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 菜品类 */</span>
<span class="token keyword">class</span> <span class="token class-name">Menu</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type
        <span class="token keyword">this</span><span class="token punctuation">.</span>message <span class="token operator">=</span> message
    <span class="token punctuation">}</span>
    
    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>message<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> restaurant <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Restaurant</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
restaurant<span class="token punctuation">.</span><span class="token function">addMenu</span><span class="token punctuation">(</span><span class="token string">'YuXiangRouSi'</span><span class="token punctuation">,</span> <span class="token string">'鱼香肉丝'</span><span class="token punctuation">,</span> <span class="token string">' 真香~'</span><span class="token punctuation">)</span>			<span class="token comment">// 注册菜品</span>
restaurant<span class="token punctuation">.</span><span class="token function">addMenu</span><span class="token punctuation">(</span><span class="token string">'GongBaoJiDin'</span><span class="token punctuation">,</span> <span class="token string">'宫保鸡丁'</span><span class="token punctuation">,</span> <span class="token string">' 让我想起了外婆做的菜~'</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> dish1 <span class="token operator">=</span> restaurant<span class="token punctuation">.</span><span class="token function">getMenu</span><span class="token punctuation">(</span><span class="token string">'YuXiangRouSi'</span><span class="token punctuation">)</span>
dish1<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>																				<span class="token comment">// 输出: 鱼香肉丝 真香~</span>
<span class="token keyword">const</span> dish2 <span class="token operator">=</span> restaurant<span class="token punctuation">.</span><span class="token function">getMenu</span><span class="token punctuation">(</span><span class="token string">'HongSaoPaiGu'</span><span class="token punctuation">)</span>	<span class="token comment">// 输出: Error 这个菜本店没有 -。-</span>
</code></pre></div>
<ul><li>我们还给 Restaurant 类增加了 <code>addMenu/removeMenu</code> 私有方法，以便于扩展。</li> <li>当然这里如果菜品参数不太一致，可以在 <code>addMenu</code> 时候注册构造函数或者类，创建的时候返回 <code>new</code> 出的对应类实例，灵活变通即可。</li></ul>
<p><strong>3. 工厂模式的通用实现</strong></p>
<blockquote><p>根据上面的例子我们可以提炼一下工厂模式，饭店可以被认为是工厂类（Factory），菜品是产品（Product），如果我们希望获得菜品实例，通过工厂类就可以拿到产品实例，不用关注产品实例创建流程。主要有下面几个概念：</p></blockquote>
<ul><li>Factory ：工厂，负责返回产品实例；</li> <li>Product ：产品，访问者从工厂拿到产品实例；</li></ul>
<p>结构大概如下：</p>
<p><img alt="" src="https://s.poetries.top/gitee/2020/07/83.png"></p>
<p>下面用通用的方法实现，这里直接用 class 语法：</p>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* 工厂类 */</span>
<span class="token keyword">class</span> <span class="token class-name">Factory</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">'Product1'</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Product1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">case</span> <span class="token string">'Product2'</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Product2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'当前没有这个产品'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 产品类1 */</span>
<span class="token keyword">class</span> <span class="token class-name">Product1</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'Product1'</span> <span class="token punctuation">}</span>
    
    <span class="token function">operate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 产品类2 */</span>
<span class="token keyword">class</span> <span class="token class-name">Product2</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'Product2'</span> <span class="token punctuation">}</span>
    
    <span class="token function">operate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> prod1 <span class="token operator">=</span> Factory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">'Product1'</span><span class="token punctuation">)</span>
prod1<span class="token punctuation">.</span><span class="token function">operate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>																	<span class="token comment">// 输出: Product1</span>
<span class="token keyword">const</span> prod2 <span class="token operator">=</span> Factory<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">'Product3'</span><span class="token punctuation">)</span>		<span class="token comment">// 输出: Error 当前没有这个产品</span>
</code></pre></div>
<blockquote><p>注意，由于 JavaScript 的灵活，简单工厂模式返回的产品对象不一定非要是类实例，也可以是字面量形式的对象，所以读者可以根据场景灵活选择返回的产品对象形式。</p></blockquote>
<p><strong>4. 源码中的工厂模式</strong></p>
<p><strong>4.1 Vue/React 源码中的工厂模式</strong></p>
<blockquote><p>和原生的 <code>document.createElement</code> 类似，Vue 和 <code>React</code> 这种具有虚拟 <code>DOM</code>树（Virtual Dom Tree）机制的框架在生成虚拟 <code>DOM</code> 的时候，都提供了 <code>createElement</code> 方法用来生成 <code>VNode</code>，用来作为真实 DOM 节点的映射：</p></blockquote>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Vue</span>
<span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'h3'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'main-title'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'avatar'</span><span class="token punctuation">,</span> <span class="token literal-property property">attrs</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">'../avatar.jpg'</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">class</span><span class="token operator">:</span> <span class="token string">'user-desc'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'长得帅老的快，长得丑活得久'</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// React</span>
React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'h3'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">className</span><span class="token operator">:</span> <span class="token string">'user-info'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token string">'../avatar.jpg'</span><span class="token punctuation">,</span> <span class="token literal-property property">className</span><span class="token operator">:</span> <span class="token string">'avatar'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  React<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">className</span><span class="token operator">:</span> <span class="token string">'user-desc'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'长得帅老的快，长得丑活得久'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre></div>
<p><strong><code>createElemen</code>t 函数结构大概如下：</strong></p>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Vnode</span> <span class="token punctuation">(</span>tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Vnode</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> children<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div>
<blockquote><p>可以看到 <code>createElement</code> 函数内会进行 <code>VNode</code> 的具体创建，创建的过程是很复杂的，而框架提供的 <code>createElement</code> 工厂方法封装了复杂的创建与验证过程，对于使用者来说就很方便了。</p></blockquote>
<p><strong>4.2 vue-router 源码中的工厂模式</strong></p>
<blockquote><p>工厂模式在源码中应用频繁，以 <code>vue-router</code> 中的源码为例，代码位置：<code>vue-router/src/index.js</code></p></blockquote>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/index.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">VueRouter</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>mode <span class="token operator">=</span> mode	<span class="token comment">// 路由模式</span>
        
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>mode<span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token comment">// 简单工厂</span>
            <span class="token keyword">case</span> <span class="token string">'history'</span><span class="token operator">:</span>       <span class="token comment">// history 方式</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HTML5History</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>base<span class="token punctuation">)</span>
                <span class="token keyword">break</span>
            <span class="token keyword">case</span> <span class="token string">'hash'</span><span class="token operator">:</span>          <span class="token comment">// hash 方式</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashHistory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>base<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fallback<span class="token punctuation">)</span>
                <span class="token keyword">break</span>
            <span class="token keyword">case</span> <span class="token string">'abstract'</span><span class="token operator">:</span>      <span class="token comment">// abstract 方式</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>history <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbstractHistory</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>base<span class="token punctuation">)</span>
                <span class="token keyword">break</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token comment">// ... 初始化失败报错</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div>
<blockquote><p>稍微解释一下这里的源码。mode 是路由创建的模式，这里有三种 <code>History</code>、<code>Hash</code>、<code>Abstract</code>，前两种我们已经很熟悉了，<code>History</code> 是 <code>H5</code> 的路由方式，<code>Hash</code> 是路由中带 # 的路由方式，<code>Abstract</code> 代表非浏览器环境中路由方式，比如 <code>Node</code>、<code>weex</code> 等；<code>this.history</code> 用来保存路由实例，<code>vue-router</code> 中使用了工厂模式的思想来获得响应路由控制类的实例。</p></blockquote>
<ul><li>源码里没有把工厂方法的产品创建流程封装出来，而是直接将产品实例的创建流程暴露在 <code>VueRouter</code> 的构造函数中，在被 new 的时候创建对应产品实例，相当于 <code>VueRouter</code> 的构造函数就是一个工厂方法。</li> <li>如果一个系统不是 <code>SPA</code> （Single Page Application，单页应用），而是是 <code>MPA</code>（Multi Page Application，多页应用），那么就需要创建多个 <code>VueRouter</code> 的实例，此时 <code>VueRouter</code> 的构造函数也就是工厂方法将会被多次执行，以分别获得不同实例。</li></ul>
<p><strong>5. 工厂模式的优缺点</strong></p>
<p>工厂模式将对象的创建和实现分离，这带来了优点：</p>
<ul><li>良好的封装，代码结构清晰，访问者无需知道对象的创建流程，特别是创建比较复杂的情况下；</li> <li>扩展性优良，通过工厂方法隔离了用户和创建流程隔离，符合开放封闭原则；</li> <li>解耦了高层逻辑和底层产品类，符合最少知识原则，不需要的就不要去交流；</li> <li>工厂模式的缺点：带来了额外的系统复杂度，增加了抽象性；</li></ul>
<p><strong>6. 工厂模式的使用场景</strong></p>
<p>那么什么时候使用工厂模式呢：</p>
<ul><li>对象的创建比较复杂，而访问者无需知道创建的具体流程；</li> <li>处理大量具有相同属性的小对象；</li></ul>
<p>什么时候不该用工厂模式：滥用只是增加了不必要的系统复杂度，过犹不及。</p>
<p><strong>7. 其他相关模式</strong></p>
<p><strong>7.1 工厂模式与抽象工厂模式</strong></p>
<p>这两个方式可以组合使用，具体联系与区别在抽象工厂模式中讨论。</p>
<p><strong>7.2 工厂模式与模板方法模式</strong></p>
<p>这两个模式看起来比较类似，不过主要区别是：</p>
<ul><li>工厂模式 主要关注产品实例的创建，对创建流程封闭起来；</li> <li>模板方法模式 主要专注的是为固定的算法骨架提供某些步骤的实现；</li> <li>这两个模式也可以组合一起来使用，比如在模板方法模式里面，使用工厂方法来创建模板方法需要的对象。</li></ul>
<h3 id="抽象工厂模式"><a href="#抽象工厂模式" class="header-anchor">#</a> 抽象工厂模式</h3>
<blockquote><p>工厂模式 （Factory Pattern），根据输入的不同返回不同类的实例，一般用来创建同一类对象。工厂方式的主要思想是将对象的创建与对象的实现分离。</p></blockquote>
<ul><li>抽象工厂 （Abstract Factory）：通过对类的工厂抽象使其业务用于对产品类簇的创建，而不是负责创建某一类产品的实例。关键在于使用抽象类制定了实例的结构，调用者直接面向实例的结构编程，从实例的具体实现中解耦。</li> <li>我们知道 JavaScript 并不是强面向对象语言，所以使用传统编译型语言比如 JAVA、C#、C++ 等实现的设计模式和 JavaScript 不太一样，比如 JavaScript 中没有原生的类和接口等（不过 ES6+ 渐渐提供类似的语法糖），我们可以用变通的方式来解决。最重要的是设计模式背后的核心思想，和它所要解决的问题。</li></ul>
<p><strong>1. 你曾见过的抽象工厂模式</strong></p>
<p>还是使用上一节工厂模式中使用的饭店例子。</p>
<ul><li><p>你再次来到了小区的饭店，跟老板说来一份鱼香肉丝，来一份宫保鸡丁，来一份番茄鸡蛋汤，来一份排骨汤（今天可能比较想喝汤）。无论什么样的菜，还是什么样的汤，他们都具有同样的属性，比如菜都可以吃，汤都可以喝。所以我们不论拿到什么菜，都可以吃，而不论拿到什么汤，都可以喝。对于饭店也一样，这个饭店可以做菜做汤，另一个饭店也可以，那么这两个饭店就具有同样的功能结构。</p></li> <li><p>面的场景都是属于抽象工厂模式的例子。菜类属于抽象产品类，制定具体产品菜类所具备的属性，而饭店和之前的工厂模式一样，负责具体生产产品实例，访问者通过老板获取想拿的产品。只要我们点的是汤类，即使还没有被做出来，我们就知道是可以喝的。推广一下，饭店功能也可以被抽象（抽象饭店类），继承这个类的饭店实例都具有做菜和做汤的功能，这样也完成了抽象类对实例的结构约束。</p></li> <li><p>在类似场景中，这些例子有特点：只要实现了抽象类的实例，都实现了抽象类制定的结构；</p></li></ul>
<p><strong>2. 实例的代码实现</strong></p>
<blockquote><p>我们知道 JavaScript 并不强面向对象，也没有提供抽象类（至少目前没有提供），但是可以模拟抽象类。用对 <code>new.target</code> 来判断 new 的类，在父类方法中 <code>throw new Error()</code>，如果子类中没有实现这个方法就会抛错，这样来模拟抽象类：</p></blockquote>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* 抽象类，ES6 class 方式 */</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractClass1</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target <span class="token operator">===</span> AbstractClass1<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象类不能直接实例化!'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* 抽象方法 */</span>
    <span class="token function">operate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象方法不能调用!'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 抽象类，ES5 构造函数方式 */</span>
<span class="token keyword">var</span> <span class="token function-variable function">AbstractClass2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target <span class="token operator">===</span> AbstractClass2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象类不能直接实例化!'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 抽象方法，使用原型方式添加 */</span>
<span class="token class-name">AbstractClass2</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">operate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象方法不能调用!'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
</code></pre></div>
<p>下面用 JavaScript 将上面介绍的饭店例子实现一下。</p>
<p>首先使用原型方式：</p>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* 饭店方法 */</span>
<span class="token keyword">function</span> <span class="token function">Restaurant</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

Restaurant<span class="token punctuation">.</span><span class="token function-variable function">orderDish</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'鱼香肉丝'</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">YuXiangRouSi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token string">'宫保鸡丁'</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GongBaoJiDing</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">case</span> <span class="token string">'紫菜蛋汤'</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ZiCaiDanTang</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'本店没有这个 -。-'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 菜品抽象类 */</span>
<span class="token keyword">function</span> <span class="token function">Dish</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>kind <span class="token operator">=</span> <span class="token string">'菜'</span> <span class="token punctuation">}</span>

<span class="token comment">/* 抽象方法 */</span>
<span class="token class-name">Dish</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">eat</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象方法不能调用!'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>

<span class="token comment">/* 鱼香肉丝类 */</span>
<span class="token keyword">function</span> <span class="token function">YuXiangRouSi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'鱼香肉丝'</span> <span class="token punctuation">}</span>

<span class="token class-name">YuXiangRouSi</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token class-name">YuXiangRouSi</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">eat</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>kind <span class="token operator">+</span> <span class="token string">' - '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' 真香~'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 宫保鸡丁类 */</span>
<span class="token keyword">function</span> <span class="token function">GongBaoJiDing</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'宫保鸡丁'</span> <span class="token punctuation">}</span>

<span class="token class-name">GongBaoJiDing</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token class-name">GongBaoJiDing</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">eat</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>kind <span class="token operator">+</span> <span class="token string">' - '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' 让我想起了外婆做的菜~'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> dish1 <span class="token operator">=</span> Restaurant<span class="token punctuation">.</span><span class="token function">orderDish</span><span class="token punctuation">(</span><span class="token string">'鱼香肉丝'</span><span class="token punctuation">)</span>
dish1<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> dish2 <span class="token operator">=</span> Restaurant<span class="token punctuation">.</span><span class="token function">orderDish</span><span class="token punctuation">(</span><span class="token string">'红烧排骨'</span><span class="token punctuation">)</span>

<span class="token comment">// 输出: 菜 - 鱼香肉丝 真香~</span>
<span class="token comment">// 输出: Error 本店没有这个 -。-</span>
使用 <span class="token keyword">class</span> 语法改写一下：

<span class="token comment">/* 饭店方法 */</span>
<span class="token keyword">class</span> <span class="token class-name">Restaurant</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token function">orderDish</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">'鱼香肉丝'</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">YuXiangRouSi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">case</span> <span class="token string">'宫保鸡丁'</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GongBaoJiDin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'本店没有这个 -。-'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 菜品抽象类 */</span>
<span class="token keyword">class</span> <span class="token class-name">Dish</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target <span class="token operator">===</span> Dish<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象类不能直接实例化!'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>kind <span class="token operator">=</span> <span class="token string">'菜'</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 抽象方法 */</span>
    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象方法不能调用!'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 鱼香肉丝类 */</span>
<span class="token keyword">class</span> <span class="token class-name">YuXiangRouSi</span> <span class="token keyword">extends</span> <span class="token class-name">Dish</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'鱼香肉丝'</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>kind <span class="token operator">+</span> <span class="token string">' - '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' 真香~'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 宫保鸡丁类 */</span>
<span class="token keyword">class</span> <span class="token class-name">GongBaoJiDin</span> <span class="token keyword">extends</span> <span class="token class-name">Dish</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'宫保鸡丁'</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>kind <span class="token operator">+</span> <span class="token string">' - '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' 让我想起了外婆做的菜~'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> dish0 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dish</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  										<span class="token comment">// 输出: Error 抽象方法不能调用!</span>
<span class="token keyword">const</span> dish1 <span class="token operator">=</span> Restaurant<span class="token punctuation">.</span><span class="token function">orderDish</span><span class="token punctuation">(</span><span class="token string">'鱼香肉丝'</span><span class="token punctuation">)</span>
dish1<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>																		<span class="token comment">// 输出: 菜 - 鱼香肉丝 真香~</span>
<span class="token keyword">const</span> dish2 <span class="token operator">=</span> Restaurant<span class="token punctuation">.</span><span class="token function">orderDish</span><span class="token punctuation">(</span><span class="token string">'红烧排骨'</span><span class="token punctuation">)</span> <span class="token comment">// 输出: Error 本店没有这个 -。-</span>
</code></pre></div>
<ul><li>这里的 Dish 类就是抽象产品类，继承该类的子类需要实现它的方法 eat。</li> <li>上面的实现将产品的功能结构抽象出来成为抽象产品类。事实上我们还可以更进一步，将工厂类也使用抽象类约束一下，也就是抽象工厂类，比如这个饭店可以做菜和汤，另一个饭店也可以做菜和汤，存在共同的功能结构，就可以将共同结构作为抽象类抽象出来，实现如下：</li></ul>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* 饭店 抽象类，饭店都可以做菜和汤 */</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractRestaurant</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target <span class="token operator">===</span> AbstractRestaurant<span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象类不能直接实例化!'</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>signborad <span class="token operator">=</span> <span class="token string">'饭店'</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 抽象方法：创建菜 */</span>
    <span class="token function">createDish</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象方法不能调用!'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    
    <span class="token comment">/* 抽象方法：创建汤 */</span>
    <span class="token function">createSoup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象方法不能调用!'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 具体饭店类 */</span>
<span class="token keyword">class</span> <span class="token class-name">Restaurant</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractRestaurant</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    
    <span class="token function">createDish</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">'鱼香肉丝'</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">YuXiangRouSi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">case</span> <span class="token string">'宫保鸡丁'</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GongBaoJiDing</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'本店没这个菜'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">createSoup</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">'紫菜蛋汤'</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ZiCaiDanTang</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'本店没这个汤'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 菜 抽象类，菜都有吃的功能 eat */</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractDish</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target <span class="token operator">===</span> AbstractDish<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象类不能直接实例化!'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>kind <span class="token operator">=</span> <span class="token string">'菜'</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 抽象方法 */</span>
    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象方法不能调用!'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 菜 鱼香肉丝类 */</span>
<span class="token keyword">class</span> <span class="token class-name">YuXiangRouSi</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractDish</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'鱼香肉丝'</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>kind <span class="token operator">+</span> <span class="token string">' - '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' 真香~'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 菜 宫保鸡丁类 */</span>
<span class="token keyword">class</span> <span class="token class-name">GongBaoJiDing</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractDish</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'宫保鸡丁'</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>kind <span class="token operator">+</span> <span class="token string">' - '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' 让我想起了外婆做的菜~'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 汤 抽象类，汤都有喝的功能 drink */</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractSoup</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target <span class="token operator">===</span> AbstractDish<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象类不能直接实例化!'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>kind <span class="token operator">=</span> <span class="token string">'汤'</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 抽象方法 */</span>
    <span class="token function">drink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象方法不能调用!'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 汤 紫菜蛋汤类 */</span>
<span class="token keyword">class</span> <span class="token class-name">ZiCaiDanTang</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSoup</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'紫菜蛋汤'</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">drink</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>kind <span class="token operator">+</span> <span class="token string">' - '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' 我从小喝到大~'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> restaurant <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Restaurant</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> soup1 <span class="token operator">=</span> restaurant<span class="token punctuation">.</span><span class="token function">createSoup</span><span class="token punctuation">(</span><span class="token string">'紫菜蛋汤'</span><span class="token punctuation">)</span>
soup1<span class="token punctuation">.</span><span class="token function">drink</span><span class="token punctuation">(</span><span class="token punctuation">)</span>																		<span class="token comment">// 输出: 汤 - 紫菜蛋汤 我从小喝到大~</span>
<span class="token keyword">const</span> dish1 <span class="token operator">=</span> restaurant<span class="token punctuation">.</span><span class="token function">createDish</span><span class="token punctuation">(</span><span class="token string">'鱼香肉丝'</span><span class="token punctuation">)</span>
dish1<span class="token punctuation">.</span><span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>																			<span class="token comment">// 输出: 菜 - 鱼香肉丝 真香~</span>
<span class="token keyword">const</span> dish2 <span class="token operator">=</span> restaurant<span class="token punctuation">.</span><span class="token function">createDish</span><span class="token punctuation">(</span><span class="token string">'红烧排骨'</span><span class="token punctuation">)</span>  <span class="token comment">// 输出: Error 本店没有这个 -。-</span>
</code></pre></div>
<p>这样如果创建新的饭店，新的饭店继承这个抽象饭店类，那么也要实现抽象饭店类，这样就都具有抽象饭店类制定的结构。</p>
<p><strong>3. 抽象工厂模式的通用实现</strong></p>
<blockquote><p>我们提炼一下抽象工厂模式，饭店还是工厂（Factory），菜品种类是抽象类（AbstractFactory），而实现抽象类的菜品是具体的产品（Product），通过工厂拿到实现了不同抽象类的产品，这些产品可以根据实现的抽象类被区分为类簇。主要有下面几个概念：</p></blockquote>
<ul><li>Factory ：工厂，负责返回产品实例；</li> <li>AbstractFactory ：虚拟工厂，制定工厂实例的结构；</li> <li>Product ：产品，访问者从工厂中拿到的产品实例，实现抽象类；</li> <li>AbstractProduct ：产品抽象类，由具体产品实现，制定产品实例的结构；</li></ul>
<p>概略图如下：</p>
<p><img alt="" src="https://s.poetries.top/gitee/2020/07/84.png"></p>
<p>下面是通用的实现，原型方式略过：</p>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">/* 工厂 抽象类 */</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractFactory</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target <span class="token operator">===</span> AbstractFactory<span class="token punctuation">)</span> 
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象类不能直接实例化!'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 抽象方法 */</span>
    <span class="token function">createProduct1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象方法不能调用!'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 具体饭店类 */</span>
<span class="token keyword">class</span> <span class="token class-name">Factory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractFactory</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    
    <span class="token function">createProduct1</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">'Product1'</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Product1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">case</span> <span class="token string">'Product2'</span><span class="token operator">:</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Product2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'当前没有这个产品 -。-'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 抽象产品类 */</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractProduct</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">new</span><span class="token punctuation">.</span>target <span class="token operator">===</span> AbstractProduct<span class="token punctuation">)</span> 
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象类不能直接实例化!'</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>kind <span class="token operator">=</span> <span class="token string">'抽象产品类1'</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 抽象方法 */</span>
    <span class="token function">operate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'抽象方法不能调用!'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 具体产品类1 */</span>
<span class="token keyword">class</span> <span class="token class-name">Product1</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractProduct</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'Product1'</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">operate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>kind <span class="token operator">+</span> <span class="token string">' - '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 具体产品类2 */</span>
<span class="token keyword">class</span> <span class="token class-name">Product2</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractProduct</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'Product2'</span>
    <span class="token punctuation">}</span>
    
    <span class="token function">operate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>kind <span class="token operator">+</span> <span class="token string">' - '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">const</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> prod1 <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createProduct1</span><span class="token punctuation">(</span><span class="token string">'Product1'</span><span class="token punctuation">)</span>
prod1<span class="token punctuation">.</span><span class="token function">operate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>																		<span class="token comment">// 输出: 抽象产品类1 - Product1</span>
<span class="token keyword">const</span> prod2 <span class="token operator">=</span> factory<span class="token punctuation">.</span><span class="token function">createProduct1</span><span class="token punctuation">(</span><span class="token string">'Product3'</span><span class="token punctuation">)</span>	<span class="token comment">// 输出: Error 当前没有这个产品 -。-</span>
</code></pre></div>
<ul><li>如果希望增加第二个类簇的产品，除了需要改一下对应工厂类之外，还需要增加一个抽象产品类，并在抽象产品类基础上扩展新的产品。</li> <li>我们在实际使用的时候不一定需要每个工厂都继承抽象工厂类，比如只有一个工厂的话我们可以直接使用工厂模式，在实战中灵活使用。</li></ul>
<p><strong>4. 抽象工厂模式的优缺点</strong></p>
<p><strong>抽象模式的优点：</strong></p>
<blockquote><p>抽象产品类将产品的结构抽象出来，访问者不需要知道产品的具体实现，只需要面向产品的结构编程即可，从产品的具体实现中解耦；</p></blockquote>
<p><strong>抽象模式的缺点：</strong></p>
<ul><li>扩展新类簇的产品类比较困难，因为需要创建新的抽象产品类，并且还要修改工厂类，违反开闭原则；</li> <li>带来了系统复杂度，增加了新的类，和新的继承关系；</li></ul>
<p><strong>5. 抽象工厂模式的使用场景</strong></p>
<blockquote><p>如果一组实例都有相同的结构，那么就可以使用抽象工厂模式。</p></blockquote>
<p><strong>6. 其他相关模式</strong> <strong>6.1 抽象工厂模式与工厂模式</strong></p>
<p>工厂模式和抽象工厂模式的区别：</p>
<ul><li>工厂模式 主要关注单独的产品实例的创建；</li> <li>抽象工厂模式 主要关注产品类簇实例的创建，如果产品类簇只有一个产品，那么这时的抽象工厂模式就退化为工厂模式了；根据场景灵活使用即可。</li></ul>
<h3 id="建造者模式"><a href="#建造者模式" class="header-anchor">#</a> 建造者模式</h3>
<blockquote><p>建造者模式（Builder Pattern）又称生成器模式，分步构建一个复杂对象，并允许按步骤构造。同样的构建过程可以采用不同的表示，将一个复杂对象的构建层与其表示层分离。</p></blockquote>
<ul><li>在工厂模式中，创建的结果都是一个完整的个体，我们对创建的过程并不关心，只需了解创建的结果。而在建造者模式中，我们关心的是对象的创建过程，因此我们通常将创建的复杂对象的模块化，使得被创建的对象的每一个子模块都可以得到高质量的复用，当然在灵活的 JavaScript 中我们可以有更灵活的实现。</li></ul>
<p><strong>1. 你曾见过的建造者模式</strong></p>
<ul><li>假定我们需要建造一个车，车这个产品是由多个部件组成，车身、引擎、轮胎。汽车制造厂一般不会自己完成每个部件的制造，而是把部件的制造交给对应的汽车零部件制造商，自己只进行装配，最后生产出整车。整车的每个部件都是一个相对独立的个体，都具有自己的生产过程，多个部件经过一系列的组装共同组成了一个完整的车。</li> <li>类似的场景还有很多，比如生产一个笔记本电脑，由主板、显示器、壳子组成，每个部件都有自己独立的行为和功能，他们共同组成了一个笔记本电脑。笔记本电脑厂从部件制造商处获得制造完成的部件，再由自己完成组装，得到笔记本电脑这个完整的产品。</li></ul>
<p><strong>在这些场景中，有以下特点：</strong></p>
<ul><li>整车制造厂（指挥者）无需知道零部件的生产过程，零部件的生产过程一般由零部件厂商（建造者）来完成；</li> <li>整车制造厂（指挥者）决定以怎样的装配方式来组装零部件，以得到最终的产品；</li></ul>
<p><strong>2. 实例的代码实现</strong></p>
<p>我们可以使用 JavaScript 来将上面的装配汽车的例子实现一下。</p>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 建造者，汽车部件厂家，提供具体零部件的生产</span>
<span class="token keyword">function</span> <span class="token function">CarBuilder</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color <span class="token operator">=</span> <span class="token string">'white'</span><span class="token punctuation">,</span> weight <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color
    <span class="token keyword">this</span><span class="token punctuation">.</span>weight <span class="token operator">=</span> weight
<span class="token punctuation">}</span>

<span class="token comment">// 生产部件，轮胎</span>
<span class="token class-name">CarBuilder</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">buildTyre</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'small'</span><span class="token operator">:</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>tyreType <span class="token operator">=</span> <span class="token string">'小号轮胎'</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>tyreIntro <span class="token operator">=</span> <span class="token string">'正在使用小号轮胎'</span>
            <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token string">'normal'</span><span class="token operator">:</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>tyreType <span class="token operator">=</span> <span class="token string">'中号轮胎'</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>tyreIntro <span class="token operator">=</span> <span class="token string">'正在使用中号轮胎'</span>
            <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token string">'big'</span><span class="token operator">:</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>tyreType <span class="token operator">=</span> <span class="token string">'大号轮胎'</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>tyreIntro <span class="token operator">=</span> <span class="token string">'正在使用大号轮胎'</span>
            <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 生产部件，发动机</span>
<span class="token class-name">CarBuilder</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">buildEngine</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">case</span> <span class="token string">'small'</span><span class="token operator">:</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>engineType <span class="token operator">=</span> <span class="token string">'小马力发动机'</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>engineIntro <span class="token operator">=</span> <span class="token string">'正在使用小马力发动机'</span>
            <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token string">'normal'</span><span class="token operator">:</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>engineType <span class="token operator">=</span> <span class="token string">'中马力发动机'</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>engineIntro <span class="token operator">=</span> <span class="token string">'正在使用中马力发动机'</span>
            <span class="token keyword">break</span>
        <span class="token keyword">case</span> <span class="token string">'big'</span><span class="token operator">:</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>engineType <span class="token operator">=</span> <span class="token string">'大马力发动机'</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>engineIntro <span class="token operator">=</span> <span class="token string">'正在使用大马力发动机'</span>
            <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 奔驰厂家，负责最终汽车产品的装配 */</span>
<span class="token keyword">function</span> <span class="token function">benChiDirector</span><span class="token punctuation">(</span><span class="token parameter">tyre<span class="token punctuation">,</span> engine<span class="token punctuation">,</span> param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> _car <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CarBuilder</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span>
    _car<span class="token punctuation">.</span><span class="token function">buildTyre</span><span class="token punctuation">(</span>tyre<span class="token punctuation">)</span>
    _car<span class="token punctuation">.</span><span class="token function">buildEngine</span><span class="token punctuation">(</span>engine<span class="token punctuation">)</span>
    <span class="token keyword">return</span> _car
<span class="token punctuation">}</span>

<span class="token comment">// 获得产品实例</span>
<span class="token keyword">var</span> benchi1 <span class="token operator">=</span> <span class="token function">benChiDirector</span><span class="token punctuation">(</span><span class="token string">'small'</span><span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token literal-property property">weight</span><span class="token operator">:</span> <span class="token string">'1600kg'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>benchi1<span class="token punctuation">)</span>

<span class="token comment">// 输出：</span>
<span class="token comment">// {</span>
<span class="token comment">//   color: "red"</span>
<span class="token comment">//   weight: "1600kg"</span>
<span class="token comment">//   tyre: Tyre {tyreType: "小号轮胎", tyreIntro: "正在使用小号轮胎"}</span>
<span class="token comment">//   engine: Engine {engineType: "大马力发动机", engineIntro: "正在使用大马力发动机"}</span>
<span class="token comment">// }</span>
</code></pre></div>
<blockquote><p>如果访问者希望获得另一个型号的车，比如有「空调」功能的车，那么我们只需要给 <code>CarBuilder</code> 的原型 <code>prototype</code> 上增加一个空调部件的建造方法，然后再新建一个新的奔驰厂家指挥者方法。</p></blockquote>
<p>也可以使用 ES6 的写法改造一下：</p>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 建造者，汽车部件厂家，提供具体零部件的生产</span>
<span class="token keyword">class</span> <span class="token class-name">CarBuilder</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color <span class="token operator">=</span> <span class="token string">'white'</span><span class="token punctuation">,</span> weight <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color
        <span class="token keyword">this</span><span class="token punctuation">.</span>weight <span class="token operator">=</span> weight
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 生产部件，轮胎 */</span>
    <span class="token function">buildTyre</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> tyre <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">'small'</span><span class="token operator">:</span>
                tyre<span class="token punctuation">.</span>tyreType <span class="token operator">=</span> <span class="token string">'小号轮胎'</span>
                tyre<span class="token punctuation">.</span>tyreIntro <span class="token operator">=</span> <span class="token string">'正在使用小号轮胎'</span>
                <span class="token keyword">break</span>
            <span class="token keyword">case</span> <span class="token string">'normal'</span><span class="token operator">:</span>
                tyre<span class="token punctuation">.</span>tyreType <span class="token operator">=</span> <span class="token string">'中号轮胎'</span>
                tyre<span class="token punctuation">.</span>tyreIntro <span class="token operator">=</span> <span class="token string">'正在使用中号轮胎'</span>
                <span class="token keyword">break</span>
            <span class="token keyword">case</span> <span class="token string">'big'</span><span class="token operator">:</span>
                tyre<span class="token punctuation">.</span>tyreType <span class="token operator">=</span> <span class="token string">'大号轮胎'</span>
                tyre<span class="token punctuation">.</span>tyreIntro <span class="token operator">=</span> <span class="token string">'正在使用大号轮胎'</span>
                <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>tyre <span class="token operator">=</span> tyre
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 生产部件，发动机 */</span>
    <span class="token function">buildEngine</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> engine <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">'small'</span><span class="token operator">:</span>
                engine<span class="token punctuation">.</span>engineType <span class="token operator">=</span> <span class="token string">'小马力发动机'</span>
                engine<span class="token punctuation">.</span>engineIntro <span class="token operator">=</span> <span class="token string">'正在使用小马力发动机'</span>
                <span class="token keyword">break</span>
            <span class="token keyword">case</span> <span class="token string">'normal'</span><span class="token operator">:</span>
                engine<span class="token punctuation">.</span>engineType <span class="token operator">=</span> <span class="token string">'中马力发动机'</span>
                engine<span class="token punctuation">.</span>engineIntro <span class="token operator">=</span> <span class="token string">'正在使用中马力发动机'</span>
                <span class="token keyword">break</span>
            <span class="token keyword">case</span> <span class="token string">'big'</span><span class="token operator">:</span>
                engine<span class="token punctuation">.</span>engineType <span class="token operator">=</span> <span class="token string">'大马力发动机'</span>
                engine<span class="token punctuation">.</span>engineIntro <span class="token operator">=</span> <span class="token string">'正在使用大马力发动机'</span>
                <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>engine <span class="token operator">=</span> engine
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 指挥者，负责最终汽车产品的装配 */</span>
<span class="token keyword">class</span> <span class="token class-name">BenChiDirector</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">tyre<span class="token punctuation">,</span> engine<span class="token punctuation">,</span> param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> _car <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CarBuilder</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span>
        _car<span class="token punctuation">.</span><span class="token function">buildTyre</span><span class="token punctuation">(</span>tyre<span class="token punctuation">)</span>
        _car<span class="token punctuation">.</span><span class="token function">buildEngine</span><span class="token punctuation">(</span>engine<span class="token punctuation">)</span>
        <span class="token keyword">return</span> _car
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 获得产品实例</span>
<span class="token keyword">const</span> benchi1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BenChiDirector</span><span class="token punctuation">(</span><span class="token string">'small'</span><span class="token punctuation">,</span> <span class="token string">'big'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token literal-property property">weight</span><span class="token operator">:</span> <span class="token string">'1600kg'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>benchi1<span class="token punctuation">)</span>

<span class="token comment">// 输出：</span>
<span class="token comment">// {</span>
<span class="token comment">//   color: "red"</span>
<span class="token comment">//   weight: "1600kg"</span>
<span class="token comment">//   tyre: Tyre {tyreType: "小号轮胎", tyreIntro: "正在使用小号轮胎"}</span>
<span class="token comment">//   engine: Engine {engineType: "大马力发动机", engineIntro: "正在使用大马力发动机"}</span>
<span class="token comment">// }</span>
</code></pre></div>
<blockquote><p>作为灵活的 JavaScript，我们还可以使用链模式来完成部件的装配，对链模式还不熟悉的同学可以看一下后面有一篇单独介绍链模式的文章～</p></blockquote>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 建造者，汽车部件厂家</span>
<span class="token keyword">class</span> <span class="token class-name">CarBuilder</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color <span class="token operator">=</span> <span class="token string">'white'</span><span class="token punctuation">,</span> weight <span class="token operator">=</span> <span class="token string">'0'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color
        <span class="token keyword">this</span><span class="token punctuation">.</span>weight <span class="token operator">=</span> weight
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 生产部件，轮胎 */</span>
    <span class="token function">buildTyre</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> tyre <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">'small'</span><span class="token operator">:</span>
                tyre<span class="token punctuation">.</span>tyreType <span class="token operator">=</span> <span class="token string">'小号轮胎'</span>
                tyre<span class="token punctuation">.</span>tyreIntro <span class="token operator">=</span> <span class="token string">'正在使用小号轮胎'</span>
                <span class="token keyword">break</span>
            <span class="token keyword">case</span> <span class="token string">'normal'</span><span class="token operator">:</span>
                tyre<span class="token punctuation">.</span>tyreType <span class="token operator">=</span> <span class="token string">'中号轮胎'</span>
                tyre<span class="token punctuation">.</span>tyreIntro <span class="token operator">=</span> <span class="token string">'正在使用中号轮胎'</span>
                <span class="token keyword">break</span>
            <span class="token keyword">case</span> <span class="token string">'big'</span><span class="token operator">:</span>
                tyre<span class="token punctuation">.</span>tyreType <span class="token operator">=</span> <span class="token string">'大号轮胎'</span>
                tyre<span class="token punctuation">.</span>tyreIntro <span class="token operator">=</span> <span class="token string">'正在使用大号轮胎'</span>
                <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>tyre <span class="token operator">=</span> tyre
        <span class="token keyword">return</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 生产部件，发动机 */</span>
    <span class="token function">buildEngine</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> engine <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token string">'small'</span><span class="token operator">:</span>
                engine<span class="token punctuation">.</span>engineType <span class="token operator">=</span> <span class="token string">'小马力发动机'</span>
                engine<span class="token punctuation">.</span>engineIntro <span class="token operator">=</span> <span class="token string">'正在使用小马力发动机'</span>
                <span class="token keyword">break</span>
            <span class="token keyword">case</span> <span class="token string">'normal'</span><span class="token operator">:</span>
                engine<span class="token punctuation">.</span>engineType <span class="token operator">=</span> <span class="token string">'中马力发动机'</span>
                engine<span class="token punctuation">.</span>engineIntro <span class="token operator">=</span> <span class="token string">'正在使用中马力发动机'</span>
                <span class="token keyword">break</span>
            <span class="token keyword">case</span> <span class="token string">'big'</span><span class="token operator">:</span>
                engine<span class="token punctuation">.</span>engineType <span class="token operator">=</span> <span class="token string">'大马力发动机'</span>
                engine<span class="token punctuation">.</span>engineIntro <span class="token operator">=</span> <span class="token string">'正在使用大马力发动机'</span>
                <span class="token keyword">break</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>engine <span class="token operator">=</span> engine
        <span class="token keyword">return</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 汽车装配，获得产品实例</span>
<span class="token keyword">const</span> benchi1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CarBuilder</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">color</span><span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token literal-property property">weight</span><span class="token operator">:</span> <span class="token string">'1600kg'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">buildTyre</span><span class="token punctuation">(</span><span class="token string">'small'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">buildEngine</span><span class="token punctuation">(</span><span class="token string">'big'</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>benchi1<span class="token punctuation">)</span>

<span class="token comment">// 输出：</span>
<span class="token comment">// {</span>
<span class="token comment">//   color: "red"</span>
<span class="token comment">//   weight: "1600kg"</span>
<span class="token comment">//   tyre: Tyre {tyre: "小号轮胎", tyreIntro: "正在使用小号轮胎"}</span>
<span class="token comment">//   engine: Engine {engine: "大马力发动机", engineIntro: "正在使用大马力发动机"}</span>
<span class="token comment">// }</span>
</code></pre></div>
<blockquote><p>这样将最终产品的创建流程使用链模式来实现，相当于将指挥者退化，指挥的过程通过链模式让用户自己实现，这样既增加了灵活性，装配过程也一目了然。如果希望扩展产品的部件，那么在建造者上增加部件实现方法，再适当修改链模式即可。</p></blockquote>
<p><strong>3. 建造者模式的通用实现</strong></p>
<blockquote><p>我们提炼一下建造者模式，这里的生产汽车的奔驰厂家就相当于指挥者（Director），厂家负责将不同的部件组装成最后的产品（Product），而部件的生产者是部件厂家相当于建造者（Builder），我们通过指挥者就可以获得希望的复杂的产品对象，再通过访问不同指挥者获得装配方式不同的产品。主要有下面几个概念：</p></blockquote>
<ul><li>Director： 指挥者，调用建造者中的部件具体实现进行部件装配，相当于整车组装厂，最终返回装配完毕的产品；</li> <li>Builder： 建造者，含有不同部件的生产方式给指挥者调用，是部件真正的生产者，但没有部件的装配流程；</li> <li>Product： 产品，要返回给访问者的复杂对象；</li> <li>建造者模式的主要功能是构建复杂的产品，并且是复杂的、需要分步骤构建的产品，其构建的算法是统一的，构建的过程由指挥者决定，只要配置不同的指挥者，就可以构建出不同的复杂产品来。也就是说，建造者模式将产品装配的算法和具体部件的实现分离，这样构建的算法可以扩展和复用，部件的具体实现也可以方便地扩展和复用，从而可以灵活地通过组合来构建出不同的产品对象。</li></ul>
<p>概略图如下：</p>
<p><img alt="" src="https://s.poetries.top/gitee/2020/07/85.png"></p>
<p>下面是通用的实现。</p>
<p>首先使用 ES6 的 class 语法：</p>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 建造者，部件生产</span>
<span class="token keyword">class</span> <span class="token class-name">ProductBuilder</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>param <span class="token operator">=</span> param
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 生产部件，part1 */</span>
    <span class="token function">buildPart1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ... Part1 生产过程</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>part1 <span class="token operator">=</span> <span class="token string">'part1'</span>
        
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 生产部件，part2 */</span>
    <span class="token function">buildPart2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ... Part2 生产过程</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>part2 <span class="token operator">=</span> <span class="token string">'part2'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 指挥者，负责最终产品的装配 */</span>
<span class="token keyword">class</span> <span class="token class-name">Director</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> _product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProductBuilder</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span>
        _product<span class="token punctuation">.</span><span class="token function">buildPart1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        _product<span class="token punctuation">.</span><span class="token function">buildPart2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> _product
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 获得产品实例</span>
<span class="token keyword">const</span> product <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Director</span><span class="token punctuation">(</span><span class="token string">'param'</span><span class="token punctuation">)</span>
结合链模式：

<span class="token comment">// 建造者，汽车部件厂家</span>
<span class="token keyword">class</span> <span class="token class-name">CarBuilder</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>param <span class="token operator">=</span> param
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 生产部件，part1 */</span>
    <span class="token function">buildPart1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>part1 <span class="token operator">=</span> <span class="token string">'part1'</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* 生产部件，part2 */</span>
    <span class="token function">buildPart2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>part2 <span class="token operator">=</span> <span class="token string">'part2'</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 汽车装配，获得产品实例</span>
<span class="token keyword">const</span> benchi1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CarBuilder</span><span class="token punctuation">(</span><span class="token string">'param'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">buildPart1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">buildPart2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<ul><li>如果希望扩展实例的功能，那么只需要在建造者类的原型上增加一个实例方法，再返回 <code>this</code> 即可。</li> <li>值得一提的是，结合链模式的建造者模式中，装配复杂对象的链式装配过程就是指挥者 Director 角色，只不过在链式装配过程中不再封装在具体指挥者中，而是由使用者自己确定装配过程。</li></ul>
<p><strong>4. 实战中的建造者模式</strong></p>
<p><strong>4.1 重构一个具有很多参数的构造函数</strong></p>
<p>有时候你会遇到一个参数很多的构造函数，比如：</p>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 汽车建造者</span>
<span class="token keyword">class</span> <span class="token class-name">CarBuilder</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">engine<span class="token punctuation">,</span> weight<span class="token punctuation">,</span> height<span class="token punctuation">,</span> color<span class="token punctuation">,</span> tyre<span class="token punctuation">,</span> name<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>engine <span class="token operator">=</span> engine
        <span class="token keyword">this</span><span class="token punctuation">.</span>weight <span class="token operator">=</span> weight
        <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> height
        <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color
        <span class="token keyword">this</span><span class="token punctuation">.</span>tyre <span class="token operator">=</span> tyre
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> benchi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CarBuilder</span><span class="token punctuation">(</span><span class="token string">'大马力发动机'</span><span class="token punctuation">,</span> <span class="token string">'2ton'</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">,</span> <span class="token string">'大号轮胎'</span><span class="token punctuation">,</span> <span class="token string">'奔驰'</span><span class="token punctuation">,</span> <span class="token string">'AMG'</span><span class="token punctuation">)</span>
</code></pre></div>
<blockquote><p>如果构造函数的参数多于 3 个，在使用的时候就很容易弄不清哪个参数对应的是什么含义，你可以使用对象解构赋值的方式来提高可读性和使用便利性，也可以使用建造者模式的思想来进行属性赋值，这是另一个思路。代码如下：</p></blockquote>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 汽车建造者</span>
<span class="token keyword">class</span> <span class="token class-name">CarBuilder</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">engine<span class="token punctuation">,</span> weight<span class="token punctuation">,</span> height<span class="token punctuation">,</span> color<span class="token punctuation">,</span> tyre<span class="token punctuation">,</span> name<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>engine <span class="token operator">=</span> engine
        <span class="token keyword">this</span><span class="token punctuation">.</span>weight <span class="token operator">=</span> weight
        <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> height
        <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color
        <span class="token keyword">this</span><span class="token punctuation">.</span>tyre <span class="token operator">=</span> tyre
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type
    <span class="token punctuation">}</span>
    
    <span class="token function">setCarProperty</span><span class="token punctuation">(</span><span class="token parameter">key<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
            <span class="token keyword">return</span> <span class="token keyword">this</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Key error : </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> key <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 不是本实例上的属性</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> benchi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CarBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setCarProperty</span><span class="token punctuation">(</span><span class="token string">'engine'</span><span class="token punctuation">,</span> <span class="token string">'大马力发动机'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setCarProperty</span><span class="token punctuation">(</span><span class="token string">'weight'</span><span class="token punctuation">,</span> <span class="token string">'2ton'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setCarProperty</span><span class="token punctuation">(</span><span class="token string">'height'</span><span class="token punctuation">,</span> <span class="token string">'2000mm'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setCarProperty</span><span class="token punctuation">(</span><span class="token string">'color'</span><span class="token punctuation">,</span> <span class="token string">'white'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setCarProperty</span><span class="token punctuation">(</span><span class="token string">'tyre'</span><span class="token punctuation">,</span> <span class="token string">'大号轮胎'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setCarProperty</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'奔驰'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setCarProperty</span><span class="token punctuation">(</span><span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'AMG'</span><span class="token punctuation">)</span>
</code></pre></div>
<blockquote><p>每个键都是用一个同样的方法来设置，或许你觉得不太直观，我们可以将设置每个属性的操作都单独列为一个方法，这样可读性就更高了：</p></blockquote>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 汽车建造者</span>
<span class="token keyword">class</span> <span class="token class-name">CarBuilder</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">engine<span class="token punctuation">,</span> weight<span class="token punctuation">,</span> height<span class="token punctuation">,</span> color<span class="token punctuation">,</span> tyre<span class="token punctuation">,</span> name<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>engine <span class="token operator">=</span> engine
        <span class="token keyword">this</span><span class="token punctuation">.</span>weight <span class="token operator">=</span> weight
        <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> height
        <span class="token keyword">this</span><span class="token punctuation">.</span>color <span class="token operator">=</span> color
        <span class="token keyword">this</span><span class="token punctuation">.</span>tyre <span class="token operator">=</span> tyre
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
        <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type
    <span class="token punctuation">}</span>
    
    <span class="token function">setPropertyFuncChain</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
              <span class="token keyword">const</span> funcName <span class="token operator">=</span> <span class="token string">'set'</span> <span class="token operator">+</span> key<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\w</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token parameter">str</span> <span class="token operator">=&gt;</span> str<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token keyword">this</span><span class="token punctuation">[</span>funcName<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
                  <span class="token keyword">this</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> value
                  <span class="token keyword">return</span> <span class="token keyword">this</span>
              <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> benchi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CarBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setPropertyFuncChain</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setEngine</span><span class="token punctuation">(</span><span class="token string">'大马力发动机'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setWeight</span><span class="token punctuation">(</span><span class="token string">'2ton'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setHeight</span><span class="token punctuation">(</span><span class="token string">'2000mm'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token string">'white'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setTyre</span><span class="token punctuation">(</span><span class="token string">'大号轮胎'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">'奔驰'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">'AMG'</span><span class="token punctuation">)</span>
</code></pre></div>
<p><strong>4.2 重构 React 的书写形式</strong></p>
<ul><li>注意： 这个方式不一定推荐，只是用来开阔视野。</li> <li>当我们写一个 React 组件的时候，一般结构形式如下；</li></ul>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">ContainerComponent</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{</span>
  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">.</span><span class="token function">fetchThings</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&lt;</span>PresentationalComponent <span class="token punctuation">{</span><span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>props<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ContainerComponent<span class="token punctuation">.</span>propTypes <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">fetchThings</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">.</span>isRequired
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">mapStateToProps</span> <span class="token operator">=</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">things</span><span class="token operator">:</span> state<span class="token punctuation">.</span>things
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token function-variable function">mapDispatchToProps</span> <span class="token operator">=</span> <span class="token parameter">dispatch</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">fetchThings</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">fetchThings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">selectThing</span><span class="token operator">:</span> <span class="token parameter">id</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">selectThing</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token function-variable function">blowShitUp</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">blowShitUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">connect</span><span class="token punctuation">(</span>
  mapStateToProps<span class="token punctuation">,</span>
  mapDispatchToProps
<span class="token punctuation">)</span><span class="token punctuation">(</span>ContainerComponent<span class="token punctuation">)</span>
</code></pre></div>
<blockquote><p>通过建造者模式重构，我们可以将组件形式写成如下方式：</p></blockquote>
<div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">ComponentBuilder</span><span class="token punctuation">(</span><span class="token string">'ContainerComponent'</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">props</span> <span class="token operator">=&gt;</span> <span class="token operator">&lt;</span>PresentationalComponent <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token parameter">props</span> <span class="token operator">=&gt;</span> props<span class="token punctuation">.</span><span class="token function">fetchThings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">propTypes</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">fetchThings</span><span class="token operator">:</span> PropTypes<span class="token punctuation">.</span>func<span class="token punctuation">.</span>isRequired
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">mapStateToProps</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">things</span><span class="token operator">:</span> state<span class="token punctuation">.</span>things
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">mapDispatchToProps</span><span class="token punctuation">(</span><span class="token parameter">dispatch</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">fetchThings</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">fetchThings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">selectThing</span><span class="token operator">:</span> <span class="token parameter">id</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">selectThing</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function-variable function">blowShitUp</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token function">blowShitUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div>
<p><strong>5. 建造者模式的优缺点</strong></p>
<p><strong>建造者模式的优点：</strong></p>
<ul><li>使用建造者模式可以使产品的构建流程和产品的表现分离，也就是将产品的创建算法和产品组成的实现隔离，访问者不必知道产品部件实现的细节；</li> <li>扩展方便，如果希望生产一个装配顺序或方式不同的新产品，那么直接新建一个指挥者即可，不用修改既有代码，符合开闭原则；</li> <li>更好的复用性，建造者模式将产品的创建算法和产品组成的实现分离，所以产品创建的算法可以复用，产品部件的实现也可以复用，带来很大的灵活性；</li></ul>
<p><strong>建造者模式的缺点：</strong></p>
<ul><li>建造者模式一般适用于产品之间组成部件类似的情况，如果产品之间差异性很大、复用性不高，那么不要使用建造者模式；</li> <li>实例的创建增加了许多额外的结构，无疑增加了许多复杂度，如果对象粒度不大，那么我们最好直接创建对象；</li></ul>
<p><strong>6. 建造者模式的适用场景</strong></p>
<ul><li>相同的方法，不同的执行顺序，产生不一样的产品时，可以采用建造者模式；</li> <li>产品的组成部件类似，通过组装不同的组件获得不同产品时，可以采用建造者模式；</li></ul>
<p><strong>7. 其他相关模式</strong></p>
<p><strong>7.1 建造者模式与工厂模式</strong></p>
<ul><li>建造者模式和工厂模式最终都是创建一个完整的产品，但是在建造者模式中我们更关心对象创建的过程，将创建对象的方法模块化，从而更好地复用这些模块。</li> <li>当然建造者模式与工厂模式也是可以组合使用的，比如建造者中一般会提供不同的部件实现，那么这里就可以使用工厂模式来提供具体的部件对象，再通过指挥者来进行装配。</li></ul>
<p><strong>7.2 建造者模式与模版方法模式</strong></p>
<ul><li>指挥者的实现可以和模版方法模式相结合。也就是说，指挥者中部件的装配过程，可以使用模版方法模式来固定装配算法，把部件实现方法分为模板方法和基本方法，进一步提取公共代码，扩展可变部分。</li> <li>是否采用模版方法模式看具体场景，如果产品的部件装配顺序很明确，但是具体的实现是未知的、灵活的，那么你可以适当考虑是否应该将算法骨架提取出来。</li></ul>
</div>